<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 5 Stepwise Covariates Selection | High-resolution spatial modelling of population welfare in El Salvador, a coding tutorial</title>
  <meta name="description" content="This is report provides a tutorial to conduct proof-of-concept high-resolution maps of poverty, average income and literacy. The emphasis is put on providing replicable code exemples." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 5 Stepwise Covariates Selection | High-resolution spatial modelling of population welfare in El Salvador, a coding tutorial" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is report provides a tutorial to conduct proof-of-concept high-resolution maps of poverty, average income and literacy. The emphasis is put on providing replicable code exemples." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 5 Stepwise Covariates Selection | High-resolution spatial modelling of population welfare in El Salvador, a coding tutorial" />
  
  <meta name="twitter:description" content="This is report provides a tutorial to conduct proof-of-concept high-resolution maps of poverty, average income and literacy. The emphasis is put on providing replicable code exemples." />
  

<meta name="author" content="Xavier Vollenweider, Claudio Bosco, Roberto SÃ¡nchez A, Luis Tejerina" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="simple-model.html"/>
<link rel="next" href="summary-of-resuls.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/lfx-pulse-icon-0.1.0/lfx-pulse-icon-prod.css" rel="stylesheet" />
<script src="libs/lfx-pulse-icon-0.1.0/lfx-pulse-icon-prod.js"></script>
<script src="libs/lfx-pulse-icon-0.1.0/lfx-pulse-icon-bindings.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Table of Content</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a><ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#the-first-look-at-the-data"><i class="fa fa-check"></i><b>2.1</b> The First Look at the Data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="explo.html"><a href="explo.html"><i class="fa fa-check"></i><b>3</b> Data exploration and preselection of covariates</a><ul>
<li class="chapter" data-level="3.1" data-path="explo.html"><a href="explo.html#outcome-variables-distribution-and-outliers"><i class="fa fa-check"></i><b>3.1</b> Outcome Variables: Distribution and Outliers</a><ul>
<li class="chapter" data-level="3.1.1" data-path="explo.html"><a href="explo.html#income"><i class="fa fa-check"></i><b>3.1.1</b> Income</a></li>
<li class="chapter" data-level="3.1.2" data-path="explo.html"><a href="explo.html#literacy"><i class="fa fa-check"></i><b>3.1.2</b> Literacy</a></li>
<li class="chapter" data-level="3.1.3" data-path="explo.html"><a href="explo.html#moderate-poverty"><i class="fa fa-check"></i><b>3.1.3</b> Moderate Poverty</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="explo.html"><a href="explo.html#unsupervised-dimension-reduction-based-on-distance-correlation"><i class="fa fa-check"></i><b>3.2</b> Unsupervised Dimension Reduction Based on Distance Correlation</a><ul>
<li class="chapter" data-level="3.2.1" data-path="explo.html"><a href="explo.html#obtaining-a-data-frame-with-standardized-covariates"><i class="fa fa-check"></i><b>3.2.1</b> Obtaining a Data Frame with Standardized Covariates</a></li>
<li class="chapter" data-level="3.2.2" data-path="explo.html"><a href="explo.html#dimension-reduction-based-on-distance-correlation"><i class="fa fa-check"></i><b>3.2.2</b> Dimension Reduction Based on Distance Correlation</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="explo.html"><a href="explo.html#correlations-between-the-predictors-and-the-outcome-variables"><i class="fa fa-check"></i><b>3.3</b> Correlations between the Predictors and the Outcome Variables</a><ul>
<li class="chapter" data-level="3.3.1" data-path="explo.html"><a href="explo.html#correlation-with-income"><i class="fa fa-check"></i><b>3.3.1</b> Correlation with Income</a></li>
<li class="chapter" data-level="3.3.2" data-path="explo.html"><a href="explo.html#correlation-with-literacy"><i class="fa fa-check"></i><b>3.3.2</b> Correlation with Literacy</a></li>
<li class="chapter" data-level="3.3.3" data-path="explo.html"><a href="explo.html#correlation-with-poverty"><i class="fa fa-check"></i><b>3.3.3</b> Correlation with Poverty</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="simple-model.html"><a href="simple-model.html"><i class="fa fa-check"></i><b>4</b> Fitting a simple model</a><ul>
<li class="chapter" data-level="4.1" data-path="simple-model.html"><a href="simple-model.html#loading-the-data"><i class="fa fa-check"></i><b>4.1</b> Loading the Data</a></li>
<li class="chapter" data-level="4.2" data-path="simple-model.html"><a href="simple-model.html#area-data"><i class="fa fa-check"></i><b>4.2</b> Area Data</a><ul>
<li class="chapter" data-level="4.2.1" data-path="simple-model.html"><a href="simple-model.html#spatial-dependency-with-area-data"><i class="fa fa-check"></i><b>4.2.1</b> Spatial Dependency with <em>Area Data</em></a></li>
<li class="chapter" data-level="4.2.2" data-path="simple-model.html"><a href="simple-model.html#store-the-data-for-modeling"><i class="fa fa-check"></i><b>4.2.2</b> Store the Data for Modeling</a></li>
<li class="chapter" data-level="4.2.3" data-path="simple-model.html"><a href="simple-model.html#split-the-sample-into-80-20-training-and-validation-sets"><i class="fa fa-check"></i><b>4.2.3</b> Split the Sample into 80-20 Training and Validation Sets</a></li>
<li class="chapter" data-level="4.2.4" data-path="simple-model.html"><a href="simple-model.html#formula-specifying-the-relationship-between-the-outcome-variable-and-the-fixed-and-spatial-random-effects"><i class="fa fa-check"></i><b>4.2.4</b> Formula Specifying the Relationship between the Outcome Variable and the Fixed and Spatial Random Effects</a></li>
<li class="chapter" data-level="4.2.5" data-path="simple-model.html"><a href="simple-model.html#fit-the-model-on-the-training-set"><i class="fa fa-check"></i><b>4.2.5</b> Fit the Model on the Training Set</a></li>
<li class="chapter" data-level="4.2.6" data-path="simple-model.html"><a href="simple-model.html#validate-the-model-on-the-validation-set"><i class="fa fa-check"></i><b>4.2.6</b> Validate the Model on the Validation Set</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="simple-model.html"><a href="simple-model.html#point-referenced-data"><i class="fa fa-check"></i><b>4.3</b> Point-Referenced Data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="simple-model.html"><a href="simple-model.html#spatial-dependency-with-point-referenced-data"><i class="fa fa-check"></i><b>4.3.1</b> Spatial Dependency with <em>Point-Referenced Data</em></a></li>
<li class="chapter" data-level="4.3.2" data-path="simple-model.html"><a href="simple-model.html#store-the-data-for-modeling-in-a-stack"><i class="fa fa-check"></i><b>4.3.2</b> Store the Data for Modeling in a Stack</a></li>
<li class="chapter" data-level="4.3.3" data-path="simple-model.html"><a href="simple-model.html#specifying-the-relationship-between-the-outcome-variable-and-the-fixed-and-spatial-random-effects"><i class="fa fa-check"></i><b>4.3.3</b> Specifying the Relationship between the Outcome Variable and the Fixed and Spatial Random Effects</a></li>
<li class="chapter" data-level="4.3.4" data-path="simple-model.html"><a href="simple-model.html#fit-the-model-on-the-training-set-1"><i class="fa fa-check"></i><b>4.3.4</b> Fit the Model on the Training Set</a></li>
<li class="chapter" data-level="4.3.5" data-path="simple-model.html"><a href="simple-model.html#validate-the-model-on-the-validation-set-1"><i class="fa fa-check"></i><b>4.3.5</b> Validate the Model on the Validation Set</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simple-model.html"><a href="simple-model.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>4.4</b> <em>K-fold</em> Cross-Validation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="stepwise.html"><a href="stepwise.html"><i class="fa fa-check"></i><b>5</b> Stepwise Covariates Selection</a><ul>
<li class="chapter" data-level="5.1" data-path="stepwise.html"><a href="stepwise.html#step-1-split-the-sample-into-60-20-20-training-validation-and-test-sets"><i class="fa fa-check"></i><b>5.1</b> Step 1: Split the Sample into 60-20-20 Training, Validation, and Test Sets</a></li>
<li class="chapter" data-level="5.2" data-path="stepwise.html"><a href="stepwise.html#steps-2-to-4-create-a-function"><i class="fa fa-check"></i><b>5.2</b> Steps 2 to 4: Create a Function</a></li>
<li class="chapter" data-level="5.3" data-path="stepwise.html"><a href="stepwise.html#steps-5-to-7-run-a-parallel-loop"><i class="fa fa-check"></i><b>5.3</b> Steps 5 to 7: Run a Parallel Loop</a></li>
<li class="chapter" data-level="5.4" data-path="stepwise.html"><a href="stepwise.html#step-8-inspect-the-results-and-select-a-specification"><i class="fa fa-check"></i><b>5.4</b> Step 8: Inspect the Results and Select a Specification</a></li>
<li class="chapter" data-level="5.5" data-path="stepwise.html"><a href="stepwise.html#step-9-conduct-a-final-test"><i class="fa fa-check"></i><b>5.5</b> Step 9: Conduct a Final Test</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="summary-of-resuls.html"><a href="summary-of-resuls.html"><i class="fa fa-check"></i><b>6</b> Results summary</a><ul>
<li class="chapter" data-level="6.1" data-path="summary-of-resuls.html"><a href="summary-of-resuls.html#goodness-of-fit-at-the-segmento-level"><i class="fa fa-check"></i><b>6.1</b> Goodness of Fit at the Segmento Level</a></li>
<li class="chapter" data-level="6.2" data-path="summary-of-resuls.html"><a href="summary-of-resuls.html#segmento-level-map"><i class="fa fa-check"></i><b>6.2</b> Segmento-Level Map</a></li>
<li class="chapter" data-level="6.3" data-path="summary-of-resuls.html"><a href="summary-of-resuls.html#goodness-of-fit-at-the-municipio-level"><i class="fa fa-check"></i><b>6.3</b> Goodness of Fit at the Municipio Level</a><ul>
<li class="chapter" data-level="6.3.1" data-path="summary-of-resuls.html"><a href="summary-of-resuls.html#option-1-aggregate-the-results-at-the-municipio-level-using-all-segmentos"><i class="fa fa-check"></i><b>6.3.1</b> Option 1: Aggregate the Results at the Municipio Level Using All Segmentos</a></li>
<li class="chapter" data-level="6.3.2" data-path="summary-of-resuls.html"><a href="summary-of-resuls.html#option-2-aggregate-the-results-at-the-municipio-level-using-segmentos-in-representative-municipios-only"><i class="fa fa-check"></i><b>6.3.2</b> Option 2: Aggregate the Results at the Municipio Level Using Segmentos in Representative Municipios Only</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>7</b> Discussion</a></li>
<li class="chapter" data-level="8" data-path="theory.html"><a href="theory.html"><i class="fa fa-check"></i><b>8</b> Appendix 1: Primer on INLA</a><ul>
<li class="chapter" data-level="8.1" data-path="theory.html"><a href="theory.html#area-data-versus-point-referenced-data"><i class="fa fa-check"></i><b>8.1</b> Area Data versus Point-Referenced Data</a><ul>
<li class="chapter" data-level="8.1.1" data-path="theory.html"><a href="theory.html#bayesian-approach"><i class="fa fa-check"></i><b>8.1.1</b> Bayesian Approach</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="theory.html"><a href="theory.html#model-formulation"><i class="fa fa-check"></i><b>8.2</b> Model Formulation</a><ul>
<li class="chapter" data-level="8.2.1" data-path="theory.html"><a href="theory.html#a-simple-model-that-does-not-account-for-spatial-dependence"><i class="fa fa-check"></i><b>8.2.1</b> A Simple Model That Does Not Account for Spatial Dependence</a></li>
<li class="chapter" data-level="8.2.2" data-path="theory.html"><a href="theory.html#a-spatial-model"><i class="fa fa-check"></i><b>8.2.2</b> A Spatial Model</a></li>
<li class="chapter" data-level="8.2.3" data-path="theory.html"><a href="theory.html#estimating-the-model-with-areal-data"><i class="fa fa-check"></i><b>8.2.3</b> Estimating the Model with Areal Data</a></li>
<li class="chapter" data-level="8.2.4" data-path="theory.html"><a href="theory.html#estimating-the-model-with-point-referenced-data"><i class="fa fa-check"></i><b>8.2.4</b> Estimating the Model with Point-Referenced Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>9</b> Appendix 2: Data Pre-processing</a><ul>
<li class="chapter" data-level="9.1" data-path="data.html"><a href="data.html#sources"><i class="fa fa-check"></i><b>9.1</b> Data Sources</a></li>
<li class="chapter" data-level="9.2" data-path="data.html"><a href="data.html#loading-the-survey"><i class="fa fa-check"></i><b>9.2</b> Loading the Survey</a></li>
<li class="chapter" data-level="9.3" data-path="data.html"><a href="data.html#loading-the-vectors"><i class="fa fa-check"></i><b>9.3</b> Loading the Vectors</a><ul>
<li class="chapter" data-level="9.3.1" data-path="data.html"><a href="data.html#loading-the-administrative-boundaries"><i class="fa fa-check"></i><b>9.3.1</b> Loading the Administrative Boundaries</a></li>
<li class="chapter" data-level="9.3.2" data-path="data.html"><a href="data.html#loading-the-shapefiles-containing-the-fields-used-as-covariates"><i class="fa fa-check"></i><b>9.3.2</b> Loading the Shapefiles Containing the Fields Used as Covariates</a></li>
<li class="chapter" data-level="9.3.3" data-path="data.html"><a href="data.html#loading-point-referenced-data-from-tables"><i class="fa fa-check"></i><b>9.3.3</b> Loading Point-Referenced Data from Tables</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="data.html"><a href="data.html#loading-the-rasters"><i class="fa fa-check"></i><b>9.4</b> Loading the Rasters</a><ul>
<li class="chapter" data-level="9.4.1" data-path="data.html"><a href="data.html#lights-at-night"><i class="fa fa-check"></i><b>9.4.1</b> Lights at Night</a></li>
<li class="chapter" data-level="9.4.2" data-path="data.html"><a href="data.html#precipitation"><i class="fa fa-check"></i><b>9.4.2</b> Precipitation</a></li>
<li class="chapter" data-level="9.4.3" data-path="data.html"><a href="data.html#soil-degradation"><i class="fa fa-check"></i><b>9.4.3</b> Soil Degradation</a></li>
<li class="chapter" data-level="9.4.4" data-path="data.html"><a href="data.html#vegetation-greenness"><i class="fa fa-check"></i><b>9.4.4</b> Vegetation Greenness</a></li>
<li class="chapter" data-level="9.4.5" data-path="data.html"><a href="data.html#temperature"><i class="fa fa-check"></i><b>9.4.5</b> Temperature</a></li>
<li class="chapter" data-level="9.4.6" data-path="data.html"><a href="data.html#slope"><i class="fa fa-check"></i><b>9.4.6</b> Slope</a></li>
<li class="chapter" data-level="9.4.7" data-path="data.html"><a href="data.html#other-rasters"><i class="fa fa-check"></i><b>9.4.7</b> Other Rasters</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="data.html"><a href="data.html#rasters-calculation"><i class="fa fa-check"></i><b>9.5</b> Rasters Calculation</a><ul>
<li class="chapter" data-level="9.5.1" data-path="data.html"><a href="data.html#lights-at-night-1"><i class="fa fa-check"></i><b>9.5.1</b> Lights at Night</a></li>
<li class="chapter" data-level="9.5.2" data-path="data.html"><a href="data.html#precipitation-1"><i class="fa fa-check"></i><b>9.5.2</b> Precipitation</a></li>
<li class="chapter" data-level="9.5.3" data-path="data.html"><a href="data.html#vegetation-greenness-1"><i class="fa fa-check"></i><b>9.5.3</b> Vegetation Greenness</a></li>
<li class="chapter" data-level="9.5.4" data-path="data.html"><a href="data.html#soil-degradation-1"><i class="fa fa-check"></i><b>9.5.4</b> Soil Degradation</a></li>
<li class="chapter" data-level="9.5.5" data-path="data.html"><a href="data.html#temperature-1"><i class="fa fa-check"></i><b>9.5.5</b> Temperature</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="data.html"><a href="data.html#distance-calculation"><i class="fa fa-check"></i><b>9.6</b> Distance Calculation</a><ul>
<li class="chapter" data-level="9.6.1" data-path="data.html"><a href="data.html#distance-to-public-services"><i class="fa fa-check"></i><b>9.6.1</b> Distance to Public Services</a></li>
<li class="chapter" data-level="9.6.2" data-path="data.html"><a href="data.html#distance-to-businesses"><i class="fa fa-check"></i><b>9.6.2</b> Distance to Businesses</a></li>
<li class="chapter" data-level="9.6.3" data-path="data.html"><a href="data.html#distance-to-natural-features"><i class="fa fa-check"></i><b>9.6.3</b> Distance to Natural Features</a></li>
<li class="chapter" data-level="9.6.4" data-path="data.html"><a href="data.html#stack-the-distance-maps-and-inspect-the-results"><i class="fa fa-check"></i><b>9.6.4</b> Stack the Distance Maps and Inspect the Results</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="data.html"><a href="data.html#spatial-statistics-at-the-segmento-level"><i class="fa fa-check"></i><b>9.7</b> Spatial Statistics at the Segmento Level</a><ul>
<li class="chapter" data-level="9.7.1" data-path="data.html"><a href="data.html#adjusting-the-crs-for-raster-extraction-to-segmento"><i class="fa fa-check"></i><b>9.7.1</b> Adjusting the CRS for Raster Extraction to Segmento</a></li>
<li class="chapter" data-level="9.7.2" data-path="data.html"><a href="data.html#rasters"><i class="fa fa-check"></i><b>9.7.2</b> Rasters</a></li>
<li class="chapter" data-level="9.7.3" data-path="data.html"><a href="data.html#vectors"><i class="fa fa-check"></i><b>9.7.3</b> Vectors</a></li>
<li class="chapter" data-level="9.7.4" data-path="data.html"><a href="data.html#population-density"><i class="fa fa-check"></i><b>9.7.4</b> Population Density</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="data.html"><a href="data.html#merging-the-covariates-with-the-ehpm-data"><i class="fa fa-check"></i><b>9.8</b> Merging the Covariates with the EHPM Data</a></li>
<li class="chapter" data-level="9.9" data-path="data.html"><a href="data.html#summary"><i class="fa fa-check"></i><b>9.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://flowminder.org/" target="blank">Released by Flowminder Foundation</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">High-resolution spatial modelling of population welfare in El Salvador, a coding tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stepwise" class="section level1">
<h1><span class="header-section-number">Section 5</span> Stepwise Covariates Selection</h1>
<p>This section describes a backward stepwise covariates selection process, which reduces the number of covariates from the 50 potential ones identified in section <a href="explo.html#explo">3</a> to about 10 or fewer. Here is an overview of the process:</p>
<ol style="list-style-type: decimal">
<li>Split the sample into 60-20-20 training, validation, and test sets.<br />
</li>
<li>Write the test formula without one of the 50 candidate covariates.</li>
<li>Fit the model on the training set.</li>
<li>Validate the model on the validation set and compute the goodness-of-fit statistics.</li>
<li>Repeat steps two to four once for each covariate (50 times).</li>
<li>Drop the covariate in the absence of which the fit is the best;.</li>
<li>Repeat steps two to six until no covariate is left.</li>
<li>Inspect the results to identify a parsimonious specification (typically below 10 covariates) yielding a good fit on the validation set.</li>
<li>Test the final model on the test set.</li>
</ol>
<p>The backward stepwise covariates selection process is computationally expensive. Fitting one modified BYM model takes about 3.5 minutes on a standard PC.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> Carrying out steps 1 to 5 takes about 175 minutes. Steps 6 and 7 take about 74 hours. To speed up the process, we write a function to parallelize step 5 across CPU cores. As the number of cores might be relatively limited on a PC (typically up to eight), an option is to carry out the process on the cloud, where an instance with more cores can be rented. For instance, the computing time can be reduced to below two hours with 64 cores.</p>
<p>The backward stepwise covariates selection is presented with the income model.</p>
<div id="step-1-split-the-sample-into-60-20-20-training-validation-and-test-sets" class="section level2">
<h2><span class="header-section-number">5.1</span> Step 1: Split the Sample into 60-20-20 Training, Validation, and Test Sets</h2>
<p>The observations in the dataset are split into 60-20-20 training, validation, and test sets. The model will be fitted on the training set, and income will be predicted on the training and validation sets. Predicted values in the validation set will be compared with the observed values to assess the modelâs goodness of fit.</p>
<p>Once the covariate selection process is complete and a given specification has been chosen (steps 1 to 8 above), predictions are made on the final test set to assess the final modelâs goodness of fit.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="stepwise.html#cb69-1"></a><span class="co"># Sample segmentos for training, validation, and testing  ####</span></span>
<span id="cb69-2"><a href="stepwise.html#cb69-2"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb69-3"><a href="stepwise.html#cb69-3"></a>spec =<span class="st"> </span><span class="kw">c</span>(<span class="dt">train =</span> <span class="fl">.6</span>, <span class="dt">test =</span> <span class="fl">.2</span>, <span class="dt">validate =</span> <span class="fl">.2</span>)</span>
<span id="cb69-4"><a href="stepwise.html#cb69-4"></a>g =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">cut</span>(</span>
<span id="cb69-5"><a href="stepwise.html#cb69-5"></a>  <span class="kw">seq</span>(<span class="kw">nrow</span>(data_model)), </span>
<span id="cb69-6"><a href="stepwise.html#cb69-6"></a>  <span class="kw">nrow</span>(data_model)<span class="op">*</span><span class="kw">cumsum</span>(<span class="kw">c</span>(<span class="dv">0</span>,spec)),</span>
<span id="cb69-7"><a href="stepwise.html#cb69-7"></a>  <span class="dt">labels =</span> <span class="kw">names</span>(spec)</span>
<span id="cb69-8"><a href="stepwise.html#cb69-8"></a>))</span>
<span id="cb69-9"><a href="stepwise.html#cb69-9"></a>index_val=<span class="kw">which</span>(g<span class="op">==</span><span class="st">&quot;validate&quot;</span>)</span>
<span id="cb69-10"><a href="stepwise.html#cb69-10"></a>index_train=<span class="kw">which</span>(g<span class="op">==</span><span class="st">&quot;train&quot;</span>)</span>
<span id="cb69-11"><a href="stepwise.html#cb69-11"></a>index_test=<span class="kw">which</span>(g<span class="op">==</span><span class="st">&quot;test&quot;</span>)</span>
<span id="cb69-12"><a href="stepwise.html#cb69-12"></a></span>
<span id="cb69-13"><a href="stepwise.html#cb69-13"></a>data_model<span class="op">$</span>pred=data_model<span class="op">$</span>ingpe</span>
<span id="cb69-14"><a href="stepwise.html#cb69-14"></a>data_model<span class="op">$</span>pred[<span class="kw">c</span>(index_val,index_test)] &lt;-<span class="st"> </span><span class="ot">NA</span> <span class="co"># Set the validation prediction to NA: The values will be predicted by the model and compared with observed values </span></span>
<span id="cb69-15"><a href="stepwise.html#cb69-15"></a></span>
<span id="cb69-16"><a href="stepwise.html#cb69-16"></a>mod_data_jack =<span class="st"> </span>data_model <span class="co"># Store the data into a new data frame for model fitting      </span></span>
<span id="cb69-17"><a href="stepwise.html#cb69-17"></a>mod_data_jack=mod_data_jack[<span class="kw">c</span>(index_val,index_train),] <span class="co"># Select only the training and validation sets; keep test set of final validation</span></span>
<span id="cb69-18"><a href="stepwise.html#cb69-18"></a>index_val_jack=<span class="kw">which</span>(<span class="kw">is.na</span>(mod_data_jack<span class="op">$</span>pred))</span>
<span id="cb69-19"><a href="stepwise.html#cb69-19"></a>index_train_jack=<span class="kw">which</span>(<span class="kw">is.na</span>(mod_data_jack<span class="op">$</span>pred)<span class="op">==</span>F)</span></code></pre></div>
</div>
<div id="steps-2-to-4-create-a-function" class="section level2">
<h2><span class="header-section-number">5.2</span> Steps 2 to 4: Create a Function</h2>
<p>To make reading the code easier, we create a function <code>INLA_steps_2_4</code> that implements steps 2 to 4 of the covariate selection process. The steps in <code>INLA_steps_2_4</code> are</p>
<ol style="list-style-type: decimal">
<li>Write the test formula without one of the candidate covariates.</li>
<li>Fit the model on the training set.</li>
<li>Validate the model on the validation set.</li>
<li>Compute the goodness-of-fit statistics.</li>
</ol>
<p>The <code>INLA_steps_2_4</code> accepts the following arguments: covariates formulation, index of the covariate to be removed, index of the validation set, index of the training set, data frame for the model, a string defining the outcome variable (e.g., âingpeâ), and a string defining the likelihood function (e.g., a Gaussian, gamma, or beta distribution).</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="stepwise.html#cb70-1"></a><span class="co"># INLA_set2_4_function #####</span></span>
<span id="cb70-2"><a href="stepwise.html#cb70-2"></a>INLA_steps_<span class="dv">2</span>_<span class="dv">4</span>=<span class="cf">function</span>(covariates_formulation, <span class="co"># The formulation of each covariate</span></span>
<span id="cb70-3"><a href="stepwise.html#cb70-3"></a>                        ix, <span class="co"># The index of the covariate to be removed</span></span>
<span id="cb70-4"><a href="stepwise.html#cb70-4"></a>                        index_val, <span class="co"># The index of the validation set</span></span>
<span id="cb70-5"><a href="stepwise.html#cb70-5"></a>                        index_train, <span class="co"># The index of the training set</span></span>
<span id="cb70-6"><a href="stepwise.html#cb70-6"></a>                        mod_data_jack, <span class="co"># The data for the model</span></span>
<span id="cb70-7"><a href="stepwise.html#cb70-7"></a>                        outcome,   <span class="co"># The string defining the outcome variable, such as ingpe</span></span>
<span id="cb70-8"><a href="stepwise.html#cb70-8"></a>                        family){   <span class="co"># The string defining the likelihood </span></span>
<span id="cb70-9"><a href="stepwise.html#cb70-9"></a>  </span>
<span id="cb70-10"><a href="stepwise.html#cb70-10"></a>  <span class="co"># Formula</span></span>
<span id="cb70-11"><a href="stepwise.html#cb70-11"></a>  candidate_covariates &lt;-<span class="st"> </span>covariates_formulation </span>
<span id="cb70-12"><a href="stepwise.html#cb70-12"></a>  </span>
<span id="cb70-13"><a href="stepwise.html#cb70-13"></a>  formula_test &lt;-<span class="st"> </span><span class="kw">reformulate</span>(<span class="kw">c</span>(<span class="st">&quot;-1&quot;</span>, <span class="st">&quot;intercept&quot;</span>,</span>
<span id="cb70-14"><a href="stepwise.html#cb70-14"></a>                                <span class="kw">paste</span>(candidate_covariates[<span class="op">-</span>ix],<span class="dt">collapse=</span><span class="st">&quot;+&quot;</span>),</span>
<span id="cb70-15"><a href="stepwise.html#cb70-15"></a>                                <span class="st">&#39;f(ID,model = &quot;bym2&quot;,</span></span>
<span id="cb70-16"><a href="stepwise.html#cb70-16"></a><span class="st">                                hyper=list(</span></span>
<span id="cb70-17"><a href="stepwise.html#cb70-17"></a><span class="st">                                prec = list(prior = &quot;pc.prec&quot;, param = c(0.1, 0.0001)),</span></span>
<span id="cb70-18"><a href="stepwise.html#cb70-18"></a><span class="st">                                phi  = list(prior = &quot;pc&quot;, param = c(0.5, 0.5))),</span></span>
<span id="cb70-19"><a href="stepwise.html#cb70-19"></a><span class="st">                                graph = Segmento.Inla.nb,</span></span>
<span id="cb70-20"><a href="stepwise.html#cb70-20"></a><span class="st">                                scale.model = TRUE,</span></span>
<span id="cb70-21"><a href="stepwise.html#cb70-21"></a><span class="st">                                constr = T,</span></span>
<span id="cb70-22"><a href="stepwise.html#cb70-22"></a><span class="st">                                adjust.for.con.comp = T)&#39;</span>),</span>
<span id="cb70-23"><a href="stepwise.html#cb70-23"></a>                              <span class="st">&quot;pred&quot;</span>) <span class="co"># Rescale to allow the Newton-Raphson optimizer to converge</span></span>
<span id="cb70-24"><a href="stepwise.html#cb70-24"></a>  </span>
<span id="cb70-25"><a href="stepwise.html#cb70-25"></a>  <span class="cf">if</span>(family<span class="op">==</span><span class="st">&quot;gaussian&quot;</span>){</span>
<span id="cb70-26"><a href="stepwise.html#cb70-26"></a>    formula_test &lt;-<span class="st"> </span><span class="kw">reformulate</span>(<span class="kw">c</span>(<span class="st">&quot;-1&quot;</span>, <span class="st">&quot;intercept&quot;</span>,</span>
<span id="cb70-27"><a href="stepwise.html#cb70-27"></a>                                  <span class="kw">paste</span>(candidate_covariates[<span class="op">-</span>ix],<span class="dt">collapse=</span><span class="st">&quot;+&quot;</span>),</span>
<span id="cb70-28"><a href="stepwise.html#cb70-28"></a>                                  <span class="st">&#39;f(ID,model = &quot;bym2&quot;,</span></span>
<span id="cb70-29"><a href="stepwise.html#cb70-29"></a><span class="st">                                hyper=list(</span></span>
<span id="cb70-30"><a href="stepwise.html#cb70-30"></a><span class="st">                                prec = list(prior = &quot;pc.prec&quot;, param = c(0.1, 0.0001)),</span></span>
<span id="cb70-31"><a href="stepwise.html#cb70-31"></a><span class="st">                                phi  = list(prior = &quot;pc&quot;, param = c(0.5, 0.5))),</span></span>
<span id="cb70-32"><a href="stepwise.html#cb70-32"></a><span class="st">                                graph = Segmento.Inla.nb,</span></span>
<span id="cb70-33"><a href="stepwise.html#cb70-33"></a><span class="st">                                scale.model = TRUE,</span></span>
<span id="cb70-34"><a href="stepwise.html#cb70-34"></a><span class="st">                                constr = T,</span></span>
<span id="cb70-35"><a href="stepwise.html#cb70-35"></a><span class="st">                                adjust.for.con.comp = T)&#39;</span>),</span>
<span id="cb70-36"><a href="stepwise.html#cb70-36"></a>                                <span class="st">&quot;pred/10&quot;</span>) <span class="co"># Rescale to allow the Newton-Raphson optimizer to converge</span></span>
<span id="cb70-37"><a href="stepwise.html#cb70-37"></a>  }</span>
<span id="cb70-38"><a href="stepwise.html#cb70-38"></a>  <span class="co"># Fit the model</span></span>
<span id="cb70-39"><a href="stepwise.html#cb70-39"></a>  <span class="cf">if</span>(family<span class="op">%in%</span><span class="kw">c</span>(<span class="st">&quot;beta&quot;</span>,<span class="st">&quot;zeroinflatedbinomial1&quot;</span>)){</span>
<span id="cb70-40"><a href="stepwise.html#cb70-40"></a>    bym.res=INLA<span class="op">::</span><span class="kw">inla</span>(<span class="dt">formula=</span>formula_test, </span>
<span id="cb70-41"><a href="stepwise.html#cb70-41"></a>                       <span class="dt">family =</span> family, </span>
<span id="cb70-42"><a href="stepwise.html#cb70-42"></a>                       <span class="dt">data =</span> mod_data_jack,</span>
<span id="cb70-43"><a href="stepwise.html#cb70-43"></a>                       <span class="dt">Ntrials =</span> mod_data_jack<span class="op">$</span>n_obs,</span>
<span id="cb70-44"><a href="stepwise.html#cb70-44"></a>                       <span class="dt">control.predictor=</span><span class="kw">list</span>(<span class="dt">link=</span><span class="dv">1</span>,<span class="dt">compute=</span>T),</span>
<span id="cb70-45"><a href="stepwise.html#cb70-45"></a>                       <span class="dt">control.compute=</span><span class="kw">list</span>(<span class="dt">dic=</span>T, <span class="dt">cpo=</span>F),</span>
<span id="cb70-46"><a href="stepwise.html#cb70-46"></a>                       <span class="dt">control.inla =</span><span class="kw">list</span>(<span class="dt">int.strategy =</span> <span class="st">&quot;eb&quot;</span>)</span>
<span id="cb70-47"><a href="stepwise.html#cb70-47"></a>    )</span>
<span id="cb70-48"><a href="stepwise.html#cb70-48"></a>  }<span class="cf">else</span>{</span>
<span id="cb70-49"><a href="stepwise.html#cb70-49"></a>    </span>
<span id="cb70-50"><a href="stepwise.html#cb70-50"></a>    bym.res=INLA<span class="op">::</span><span class="kw">inla</span>(<span class="dt">formula=</span>formula_test, </span>
<span id="cb70-51"><a href="stepwise.html#cb70-51"></a>                       <span class="dt">family =</span> family, </span>
<span id="cb70-52"><a href="stepwise.html#cb70-52"></a>                       <span class="dt">data =</span> mod_data_jack,</span>
<span id="cb70-53"><a href="stepwise.html#cb70-53"></a>                       <span class="dt">control.predictor=</span><span class="kw">list</span>(<span class="dt">link=</span><span class="dv">1</span>,<span class="dt">compute=</span>T),</span>
<span id="cb70-54"><a href="stepwise.html#cb70-54"></a>                       <span class="dt">control.compute=</span><span class="kw">list</span>(<span class="dt">dic=</span>T, <span class="dt">cpo=</span>F),</span>
<span id="cb70-55"><a href="stepwise.html#cb70-55"></a>                       <span class="dt">control.inla =</span><span class="kw">list</span>(<span class="dt">int.strategy =</span> <span class="st">&quot;eb&quot;</span>) </span>
<span id="cb70-56"><a href="stepwise.html#cb70-56"></a>    )</span>
<span id="cb70-57"><a href="stepwise.html#cb70-57"></a>  }</span>
<span id="cb70-58"><a href="stepwise.html#cb70-58"></a>  <span class="co"># Extract the fitted values</span></span>
<span id="cb70-59"><a href="stepwise.html#cb70-59"></a>  M_fit=bym.res<span class="op">$</span>summary.fitted.values[,<span class="st">&quot;mean&quot;</span>]</span>
<span id="cb70-60"><a href="stepwise.html#cb70-60"></a>  </span>
<span id="cb70-61"><a href="stepwise.html#cb70-61"></a>  <span class="cf">if</span>(family<span class="op">%in%</span><span class="kw">c</span>(<span class="st">&quot;gamma&quot;</span>)){</span>
<span id="cb70-62"><a href="stepwise.html#cb70-62"></a>    M_fit=<span class="kw">exp</span>(M_fit) <span class="co"># Back transform to level</span></span>
<span id="cb70-63"><a href="stepwise.html#cb70-63"></a>  }</span>
<span id="cb70-64"><a href="stepwise.html#cb70-64"></a>  <span class="cf">if</span>(family<span class="op">%in%</span><span class="kw">c</span>(<span class="st">&quot;gaussian&quot;</span>)){</span>
<span id="cb70-65"><a href="stepwise.html#cb70-65"></a>    M_fit=M_fit<span class="op">*</span><span class="dv">10</span> <span class="co"># Back transform to level</span></span>
<span id="cb70-66"><a href="stepwise.html#cb70-66"></a>  }</span>
<span id="cb70-67"><a href="stepwise.html#cb70-67"></a>  </span>
<span id="cb70-68"><a href="stepwise.html#cb70-68"></a>  <span class="co"># The function for RMSE </span></span>
<span id="cb70-69"><a href="stepwise.html#cb70-69"></a>  RMSE=<span class="cf">function</span>(set,outcome,data){</span>
<span id="cb70-70"><a href="stepwise.html#cb70-70"></a>    res =<span class="st"> </span>data[set,outcome]<span class="op">-</span>M_fit[set]</span>
<span id="cb70-71"><a href="stepwise.html#cb70-71"></a>    RMSE_val &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(res<span class="op">^</span><span class="dv">2</span>,<span class="dt">na.rm=</span>T)) </span>
<span id="cb70-72"><a href="stepwise.html#cb70-72"></a>    <span class="kw">return</span>(RMSE_val)  </span>
<span id="cb70-73"><a href="stepwise.html#cb70-73"></a>  }</span>
<span id="cb70-74"><a href="stepwise.html#cb70-74"></a>  <span class="co"># The function for pseudo_r2</span></span>
<span id="cb70-75"><a href="stepwise.html#cb70-75"></a>  pseudo_r2=<span class="cf">function</span>(set,outcome,data){</span>
<span id="cb70-76"><a href="stepwise.html#cb70-76"></a>    res =<span class="st">  </span>data[set,outcome]<span class="op">-</span>M_fit[set]</span>
<span id="cb70-77"><a href="stepwise.html#cb70-77"></a>    RRes=<span class="kw">sum</span>((res)<span class="op">^</span><span class="dv">2</span>,<span class="dt">na.rm =</span> T)</span>
<span id="cb70-78"><a href="stepwise.html#cb70-78"></a>    RRtot=<span class="kw">sum</span>((data[set,outcome]<span class="op">-</span><span class="kw">mean</span>(M_fit[set],<span class="dt">na.rm=</span>T))<span class="op">^</span><span class="dv">2</span>,<span class="dt">na.rm =</span> T)</span>
<span id="cb70-79"><a href="stepwise.html#cb70-79"></a>    pseudo_r2_val=<span class="dv">1</span><span class="op">-</span>RRes<span class="op">/</span>RRtot</span>
<span id="cb70-80"><a href="stepwise.html#cb70-80"></a>    <span class="kw">return</span>(pseudo_r2_val)  </span>
<span id="cb70-81"><a href="stepwise.html#cb70-81"></a>  }</span>
<span id="cb70-82"><a href="stepwise.html#cb70-82"></a>  </span>
<span id="cb70-83"><a href="stepwise.html#cb70-83"></a>  <span class="co"># RMSE: RMSE function defined above</span></span>
<span id="cb70-84"><a href="stepwise.html#cb70-84"></a>  RMSE_val=<span class="kw">RMSE</span>(index_val,outcome,mod_data_jack)</span>
<span id="cb70-85"><a href="stepwise.html#cb70-85"></a>  RMSE_train=<span class="kw">RMSE</span>(index_train,outcome,mod_data_jack)</span>
<span id="cb70-86"><a href="stepwise.html#cb70-86"></a>  </span>
<span id="cb70-87"><a href="stepwise.html#cb70-87"></a>  <span class="co"># R2: Pseudo_r2 function defined above</span></span>
<span id="cb70-88"><a href="stepwise.html#cb70-88"></a>  r2_val=<span class="kw">pseudo_r2</span>(index_val,outcome,mod_data_jack)</span>
<span id="cb70-89"><a href="stepwise.html#cb70-89"></a>  r2_train=<span class="kw">pseudo_r2</span>(index_train,outcome,mod_data_jack)</span>
<span id="cb70-90"><a href="stepwise.html#cb70-90"></a>  </span>
<span id="cb70-91"><a href="stepwise.html#cb70-91"></a>  <span class="co"># Store the results</span></span>
<span id="cb70-92"><a href="stepwise.html#cb70-92"></a>  results_list=<span class="kw">list</span>(<span class="st">&quot;cov_i&quot;</span>=ix,</span>
<span id="cb70-93"><a href="stepwise.html#cb70-93"></a>                    <span class="st">&quot;cov_name&quot;</span>=candidate_covariates[ix],</span>
<span id="cb70-94"><a href="stepwise.html#cb70-94"></a>                    <span class="st">&quot;formula&quot;</span>=formula_test,</span>
<span id="cb70-95"><a href="stepwise.html#cb70-95"></a>                    <span class="co"># &quot;fitted_values&quot;=M_fit,</span></span>
<span id="cb70-96"><a href="stepwise.html#cb70-96"></a>                    <span class="co"># &quot;index_val&quot;=index_val,</span></span>
<span id="cb70-97"><a href="stepwise.html#cb70-97"></a>                    <span class="co"># &quot;index_train&quot;=index_train,</span></span>
<span id="cb70-98"><a href="stepwise.html#cb70-98"></a>                    <span class="co"># &quot;index_train_val&quot;=index_train_val,</span></span>
<span id="cb70-99"><a href="stepwise.html#cb70-99"></a>                    <span class="st">&quot;RMSE_val&quot;</span>=RMSE_val,</span>
<span id="cb70-100"><a href="stepwise.html#cb70-100"></a>                    <span class="st">&quot;RMSE_train&quot;</span>=RMSE_train,</span>
<span id="cb70-101"><a href="stepwise.html#cb70-101"></a>                    <span class="st">&quot;r2_val&quot;</span>=r2_val,</span>
<span id="cb70-102"><a href="stepwise.html#cb70-102"></a>                    <span class="st">&quot;r2_train&quot;</span>=r2_train,</span>
<span id="cb70-103"><a href="stepwise.html#cb70-103"></a>                    <span class="st">&quot;outcome&quot;</span>=outcome,</span>
<span id="cb70-104"><a href="stepwise.html#cb70-104"></a>                    <span class="st">&quot;family&quot;</span>=family)</span>
<span id="cb70-105"><a href="stepwise.html#cb70-105"></a>  <span class="kw">rm</span>(bym.res)</span>
<span id="cb70-106"><a href="stepwise.html#cb70-106"></a>  <span class="kw">return</span>(results_list)</span>
<span id="cb70-107"><a href="stepwise.html#cb70-107"></a>}</span></code></pre></div>
<p>We can now test the function.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="stepwise.html#cb71-1"></a><span class="co"># Test the function #####</span></span>
<span id="cb71-2"><a href="stepwise.html#cb71-2"></a>test_fct=<span class="kw">INLA_steps_2_4</span>(covariates_formulation, <span class="co"># The formulation of each covariate</span></span>
<span id="cb71-3"><a href="stepwise.html#cb71-3"></a>                        <span class="dv">1</span>, <span class="co"># The index of the covariate to be removed</span></span>
<span id="cb71-4"><a href="stepwise.html#cb71-4"></a>                        index_val_jack, <span class="co"># The index of the validation set</span></span>
<span id="cb71-5"><a href="stepwise.html#cb71-5"></a>                        index_train_jack, <span class="co"># The index of the training set</span></span>
<span id="cb71-6"><a href="stepwise.html#cb71-6"></a>                        mod_data_jack, <span class="co"># The data for the model</span></span>
<span id="cb71-7"><a href="stepwise.html#cb71-7"></a>                        <span class="st">&quot;ingpe&quot;</span>, <span class="co"># The outcome</span></span>
<span id="cb71-8"><a href="stepwise.html#cb71-8"></a>                        <span class="st">&quot;gaussian&quot;</span>) <span class="co"># The likelihood</span></span></code></pre></div>
<p>The results can then be accessed using the <code>$</code> sign. For instance, we can look at the <span class="math inline">\(R^2\)</span>:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="stepwise.html#cb72-1"></a><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;R-squared in the validation set:&quot;</span>,test_fct<span class="op">$</span>r2_val,</span>
<span id="cb72-2"><a href="stepwise.html#cb72-2"></a>            <span class="st">&quot;R-squared in the training set:&quot;</span>,test_fct<span class="op">$</span>r2_train))</span></code></pre></div>
<pre><code>## [1] &quot;R-squared in the validation set: 0.412553293719591 R-squared in the training set: 0.511180089748186&quot;</code></pre>
</div>
<div id="steps-5-to-7-run-a-parallel-loop" class="section level2">
<h2><span class="header-section-number">5.3</span> Steps 5 to 7: Run a Parallel Loop</h2>
<p>We now launch the entire backward selection process with a loop. To speed up the process, we parallelize the estimation of every single model across the cores: each core is in charge of estimating one model. In the first iteration of the loop, we start with a list of <span class="math inline">\(50\)</span> candidate covariates, and <span class="math inline">\(50\)</span> models are estimated. Each model contains all covariates minus one <span class="math inline">\(j\)</span> covariate, where <span class="math inline">\(j\)</span> is different in each model and <span class="math inline">\(j=1, ..., 50\)</span>. Once the <span class="math inline">\(50\)</span> models have been estimated, the results are collected, and the best-performing model is identified, say, for example, model k. The corresponding <span class="math inline">\(k\)</span> covariate is removed from the list of candidate covariate and the loop proceeds to the next iteration with a list of <span class="math inline">\(50-1=49\)</span> candidate covariates.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="stepwise.html#cb74-1"></a><span class="co"># Loop all covariates until only one is left #####</span></span>
<span id="cb74-2"><a href="stepwise.html#cb74-2"></a>candidate_covariates=covariates_formulation <span class="co"># Start again with the full list of candidate covariate</span></span>
<span id="cb74-3"><a href="stepwise.html#cb74-3"></a>n2drop=<span class="kw">length</span>(covariates_formulation)<span class="op">-</span><span class="dv">1</span> </span>
<span id="cb74-4"><a href="stepwise.html#cb74-4"></a>start_t=<span class="kw">Sys.time</span>()</span>
<span id="cb74-5"><a href="stepwise.html#cb74-5"></a>results_jacknife=<span class="kw">list</span>() <span class="co"># Create a list to store all the results of the jacknife selectio process</span></span>
<span id="cb74-6"><a href="stepwise.html#cb74-6"></a><span class="cf">for</span>(n_cov_to_drop <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n2drop){  <span class="co"># Repeat the step n2drop=12 times until having only 8 covariates</span></span>
<span id="cb74-7"><a href="stepwise.html#cb74-7"></a>  </span>
<span id="cb74-8"><a href="stepwise.html#cb74-8"></a>  <span class="kw">set.seed</span>(<span class="dv">101</span>)</span>
<span id="cb74-9"><a href="stepwise.html#cb74-9"></a>  </span>
<span id="cb74-10"><a href="stepwise.html#cb74-10"></a>  INLA_steps_<span class="dv">2</span>_<span class="dv">4</span>_par=<span class="cf">function</span>(cov_n){  <span class="co"># Fit the model by dropping one covariate after the other</span></span>
<span id="cb74-11"><a href="stepwise.html#cb74-11"></a>    model_fct=<span class="kw">INLA_steps_2_4</span>(candidate_covariates, <span class="co"># The formulation of each covariate</span></span>
<span id="cb74-12"><a href="stepwise.html#cb74-12"></a>                             cov_n, <span class="co"># The index of the covariate to be removed</span></span>
<span id="cb74-13"><a href="stepwise.html#cb74-13"></a>                             index_val_jack, <span class="co"># The index of the validation set</span></span>
<span id="cb74-14"><a href="stepwise.html#cb74-14"></a>                             index_train_jack, <span class="co"># The index of the validation set</span></span>
<span id="cb74-15"><a href="stepwise.html#cb74-15"></a>                             mod_data_jack,  <span class="co"># The data for the model</span></span>
<span id="cb74-16"><a href="stepwise.html#cb74-16"></a>                             <span class="st">&quot;ingpe&quot;</span>, <span class="co"># The outcome</span></span>
<span id="cb74-17"><a href="stepwise.html#cb74-17"></a>                             <span class="st">&quot;gaussian&quot;</span>) <span class="co"># The likelihood</span></span>
<span id="cb74-18"><a href="stepwise.html#cb74-18"></a>    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\014</span><span class="st">&quot;</span>) <span class="co"># Clean the consol</span></span>
<span id="cb74-19"><a href="stepwise.html#cb74-19"></a>    <span class="co"># end_t=Sys.time()</span></span>
<span id="cb74-20"><a href="stepwise.html#cb74-20"></a>    <span class="co"># I think uration=end_t-start_t</span></span>
<span id="cb74-21"><a href="stepwise.html#cb74-21"></a>    <span class="co"># Print(duration)</span></span>
<span id="cb74-22"><a href="stepwise.html#cb74-22"></a>    <span class="kw">return</span>(model_fct)</span>
<span id="cb74-23"><a href="stepwise.html#cb74-23"></a>  }</span>
<span id="cb74-24"><a href="stepwise.html#cb74-24"></a>  cov_n&lt;-<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(candidate_covariates)</span>
<span id="cb74-25"><a href="stepwise.html#cb74-25"></a>  n_cores&lt;-<span class="kw">detectCores</span>()</span>
<span id="cb74-26"><a href="stepwise.html#cb74-26"></a>  cl=<span class="kw">makeCluster</span>(n_cores)</span>
<span id="cb74-27"><a href="stepwise.html#cb74-27"></a>  start_T&lt;-<span class="kw">Sys.time</span>()</span>
<span id="cb74-28"><a href="stepwise.html#cb74-28"></a>  <span class="kw">clusterExport</span>(<span class="dt">cl=</span>cl,</span>
<span id="cb74-29"><a href="stepwise.html#cb74-29"></a>                <span class="dt">varlist=</span><span class="kw">c</span>(<span class="st">&quot;candidate_covariates&quot;</span>,</span>
<span id="cb74-30"><a href="stepwise.html#cb74-30"></a>                          <span class="st">&quot;INLA_steps_2_4&quot;</span>,</span>
<span id="cb74-31"><a href="stepwise.html#cb74-31"></a>                          <span class="st">&quot;index_val_jack&quot;</span>,</span>
<span id="cb74-32"><a href="stepwise.html#cb74-32"></a>                          <span class="st">&quot;index_train_jack&quot;</span>,</span>
<span id="cb74-33"><a href="stepwise.html#cb74-33"></a>                          <span class="st">&quot;mod_data_jack&quot;</span>,</span>
<span id="cb74-34"><a href="stepwise.html#cb74-34"></a>                          <span class="st">&quot;Segmento.Inla.nb&quot;</span>))</span>
<span id="cb74-35"><a href="stepwise.html#cb74-35"></a>  results_list&lt;-<span class="kw">clusterApply</span>(cl,cov_n,INLA_steps_<span class="dv">2</span>_<span class="dv">4</span>_par)</span>
<span id="cb74-36"><a href="stepwise.html#cb74-36"></a>  end_T&lt;-<span class="kw">Sys.time</span>()</span>
<span id="cb74-37"><a href="stepwise.html#cb74-37"></a>  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\014</span><span class="st">&quot;</span>) <span class="co"># Clean the consol</span></span>
<span id="cb74-38"><a href="stepwise.html#cb74-38"></a>  <span class="kw">print</span>(end_T<span class="op">-</span>start_T)</span>
<span id="cb74-39"><a href="stepwise.html#cb74-39"></a>  <span class="kw">stopCluster</span>(cl)</span>
<span id="cb74-40"><a href="stepwise.html#cb74-40"></a>  <span class="kw">gc</span>()</span>
<span id="cb74-41"><a href="stepwise.html#cb74-41"></a>  <span class="co"># Store all the results for a quality check</span></span>
<span id="cb74-42"><a href="stepwise.html#cb74-42"></a>  results_jacknife[[n_cov_to_drop]]=results_list </span>
<span id="cb74-43"><a href="stepwise.html#cb74-43"></a>  </span>
<span id="cb74-44"><a href="stepwise.html#cb74-44"></a>  <span class="co"># Drop the covariate that least affects the goodness of fit </span></span>
<span id="cb74-45"><a href="stepwise.html#cb74-45"></a>  </span>
<span id="cb74-46"><a href="stepwise.html#cb74-46"></a>  rmse_val=<span class="kw">lapply</span>(results_list,<span class="cf">function</span>(x) <span class="kw">unlist</span>(x<span class="op">$</span>RMSE_val))</span>
<span id="cb74-47"><a href="stepwise.html#cb74-47"></a>  rmse_val_min=<span class="kw">which.min</span>(rmse_val)</span>
<span id="cb74-48"><a href="stepwise.html#cb74-48"></a>  </span>
<span id="cb74-49"><a href="stepwise.html#cb74-49"></a>  covariates_to_be_removed=results_list[[rmse_val_min]]<span class="op">$</span>cov_name</span>
<span id="cb74-50"><a href="stepwise.html#cb74-50"></a>  </span>
<span id="cb74-51"><a href="stepwise.html#cb74-51"></a>  candidate_covariates=candidate_covariates[<span class="op">-</span><span class="kw">which</span>(candidate_covariates<span class="op">==</span>covariates_to_be_removed)]</span>
<span id="cb74-52"><a href="stepwise.html#cb74-52"></a>  <span class="kw">rm</span>(results_list)</span>
<span id="cb74-53"><a href="stepwise.html#cb74-53"></a>  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="kw">length</span>(candidate_covariates),<span class="st">&quot;covariates remaining&quot;</span>))</span>
<span id="cb74-54"><a href="stepwise.html#cb74-54"></a>  </span>
<span id="cb74-55"><a href="stepwise.html#cb74-55"></a>}</span>
<span id="cb74-56"><a href="stepwise.html#cb74-56"></a>end_t=<span class="kw">Sys.time</span>()</span>
<span id="cb74-57"><a href="stepwise.html#cb74-57"></a>duration=end_t<span class="op">-</span>start_t</span>
<span id="cb74-58"><a href="stepwise.html#cb74-58"></a><span class="kw">print</span>(duration) <span class="co"># 1.84 hours</span></span></code></pre></div>
<p>The process took slightly less than 2 hours using 64 cores on the cloud.</p>
</div>
<div id="step-8-inspect-the-results-and-select-a-specification" class="section level2">
<h2><span class="header-section-number">5.4</span> Step 8: Inspect the Results and Select a Specification</h2>
<p>We now inspect the results of the selection process. Look at the goodness of fit of the best-performing models at each covariate selection step using the R-squared and the RMSE as goodness-of-fit statistics.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="stepwise.html#cb75-1"></a><span class="co"># INCOME BYM-2 ####</span></span>
<span id="cb75-2"><a href="stepwise.html#cb75-2"></a><span class="kw">load</span>(<span class="kw">paste0</span>(dir_data,<span class="st">&quot;workspace/income_bym2_gaussian.RData&quot;</span>))</span>
<span id="cb75-3"><a href="stepwise.html#cb75-3"></a></span>
<span id="cb75-4"><a href="stepwise.html#cb75-4"></a><span class="co"># Visualize the R-squared  ####</span></span>
<span id="cb75-5"><a href="stepwise.html#cb75-5"></a><span class="co"># Extract the R-squared</span></span>
<span id="cb75-6"><a href="stepwise.html#cb75-6"></a>r2_val_max=r2_train_max=r2_val_min=r2_train_min=<span class="kw">c</span>()</span>
<span id="cb75-7"><a href="stepwise.html#cb75-7"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(results_jacknife)){</span>
<span id="cb75-8"><a href="stepwise.html#cb75-8"></a>  r2_val=<span class="kw">lapply</span>(results_jacknife[[k]],<span class="cf">function</span>(x) <span class="kw">unlist</span>(x<span class="op">$</span>r2_val))</span>
<span id="cb75-9"><a href="stepwise.html#cb75-9"></a>  r2_train=<span class="kw">lapply</span>(results_jacknife[[k]],<span class="cf">function</span>(x) <span class="kw">unlist</span>(x<span class="op">$</span>r2_train))</span>
<span id="cb75-10"><a href="stepwise.html#cb75-10"></a>  </span>
<span id="cb75-11"><a href="stepwise.html#cb75-11"></a>  <span class="co"># Get the maximum r2</span></span>
<span id="cb75-12"><a href="stepwise.html#cb75-12"></a>  r2_val_max_index=<span class="kw">which.max</span>(r2_val)</span>
<span id="cb75-13"><a href="stepwise.html#cb75-13"></a>  r2_val_max_i=r2_val[[r2_val_max_index]]</span>
<span id="cb75-14"><a href="stepwise.html#cb75-14"></a>  r2_train_max_i=r2_train[[r2_val_max_index]]</span>
<span id="cb75-15"><a href="stepwise.html#cb75-15"></a>  </span>
<span id="cb75-16"><a href="stepwise.html#cb75-16"></a>  r2_val_max=<span class="kw">c</span>(r2_val_max,r2_val_max_i)</span>
<span id="cb75-17"><a href="stepwise.html#cb75-17"></a>  r2_train_max=<span class="kw">c</span>(r2_train_max,r2_train_max_i)</span>
<span id="cb75-18"><a href="stepwise.html#cb75-18"></a>  </span>
<span id="cb75-19"><a href="stepwise.html#cb75-19"></a>  <span class="co"># Get the minimum r2</span></span>
<span id="cb75-20"><a href="stepwise.html#cb75-20"></a>  r2_val_min_index=<span class="kw">which.min</span>(r2_val)</span>
<span id="cb75-21"><a href="stepwise.html#cb75-21"></a>  r2_val_min_i=r2_val[[r2_val_min_index]]</span>
<span id="cb75-22"><a href="stepwise.html#cb75-22"></a>  r2_train_min_i=r2_train[[r2_val_min_index]]</span>
<span id="cb75-23"><a href="stepwise.html#cb75-23"></a>  </span>
<span id="cb75-24"><a href="stepwise.html#cb75-24"></a>  r2_val_min=<span class="kw">c</span>(r2_val_min,r2_val_min_i)</span>
<span id="cb75-25"><a href="stepwise.html#cb75-25"></a>  r2_train_min=<span class="kw">c</span>(r2_train_min,r2_train_min_i)</span>
<span id="cb75-26"><a href="stepwise.html#cb75-26"></a>}</span>
<span id="cb75-27"><a href="stepwise.html#cb75-27"></a></span>
<span id="cb75-28"><a href="stepwise.html#cb75-28"></a><span class="co"># Visualize the r2</span></span>
<span id="cb75-29"><a href="stepwise.html#cb75-29"></a>data2plot=<span class="kw">data.frame</span>(<span class="dt">set=</span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;val&quot;</span>,<span class="kw">length</span>(r2_val_max)),<span class="kw">rep</span>(<span class="st">&quot;train&quot;</span>,<span class="kw">length</span>(r2_val_max))),</span>
<span id="cb75-30"><a href="stepwise.html#cb75-30"></a>                     <span class="dt">index=</span><span class="kw">c</span>(<span class="kw">rev</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(r2_val_max)),<span class="kw">rev</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(r2_val_max))),</span>
<span id="cb75-31"><a href="stepwise.html#cb75-31"></a>                     <span class="dt">index_jack=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(r2_val_max),<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(r2_val_max)),</span>
<span id="cb75-32"><a href="stepwise.html#cb75-32"></a>                     <span class="dt">r2_max=</span><span class="kw">c</span>(<span class="kw">unlist</span>(r2_val_max),<span class="kw">unlist</span>(r2_train_max)),</span>
<span id="cb75-33"><a href="stepwise.html#cb75-33"></a>                     <span class="dt">r2_min=</span><span class="kw">c</span>(<span class="kw">unlist</span>(r2_val_min),<span class="kw">unlist</span>(r2_train_min)))</span>
<span id="cb75-34"><a href="stepwise.html#cb75-34"></a></span>
<span id="cb75-35"><a href="stepwise.html#cb75-35"></a>plotly<span class="op">::</span><span class="kw">plot_ly</span>(<span class="dt">data=</span>data2plot,</span>
<span id="cb75-36"><a href="stepwise.html#cb75-36"></a>                <span class="dt">x=</span><span class="op">~</span>index_jack,</span>
<span id="cb75-37"><a href="stepwise.html#cb75-37"></a>                <span class="dt">y=</span><span class="op">~</span>r2_max,</span>
<span id="cb75-38"><a href="stepwise.html#cb75-38"></a>                <span class="dt">name =</span> <span class="op">~</span>set,</span>
<span id="cb75-39"><a href="stepwise.html#cb75-39"></a>                <span class="dt">type=</span><span class="st">&quot;scatter&quot;</span>,</span>
<span id="cb75-40"><a href="stepwise.html#cb75-40"></a>                <span class="dt">mode=</span><span class="st">&quot;line&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-ccdbcb4899c04271ea40" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-ccdbcb4899c04271ea40">{"x":{"visdat":{"47c92b049e0a":["function () ","plotlyVisDat"]},"cur_data":"47c92b049e0a","attrs":{"47c92b049e0a":{"x":{},"y":{},"mode":"line","name":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"index_jack"},"yaxis":{"domain":[0,1],"automargin":true,"title":"r2_max"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39],"y":[0.503379750408935,0.495817839508031,0.49103557692346,0.489114466948889,0.485087375331708,0.483232684900609,0.481185818567013,0.48081965189631,0.480694341056751,0.479516798227265,0.479408178978352,0.476940037178042,0.475986787493983,0.475799099085215,0.474989742889438,0.472853984414298,0.470126863565677,0.470011264143951,0.469932919017184,0.468132397104931,0.466409802914662,0.466389487999065,0.465407891552569,0.45808018493941,0.457981064797186,0.457046403611638,0.456673674855469,0.455981984184691,0.453508901236946,0.447348588753317,0.445547940957851,0.44354249496866,0.441340528561004,0.439252115497677,0.424785625280583,0.420284540397423,0.419288898834228,0.415364613173235,0.411375246727817],"mode":"line","name":"train","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39],"y":[0.431293622810968,0.438951612188426,0.444859580160301,0.44886806651547,0.451494483400088,0.454023152213404,0.455986416765947,0.457920745766429,0.459295966921566,0.460874166043312,0.462071732568768,0.463446267951573,0.465995536749402,0.46819306933293,0.469789803136871,0.470522577702839,0.471294928710727,0.471892711421959,0.472208108975121,0.472622033461956,0.474352180498782,0.47464002938828,0.474768258816595,0.474697313533322,0.474481632181858,0.474106260668896,0.472284570754148,0.471665493599704,0.471278378314033,0.470283233982113,0.468492637335055,0.466450249619621,0.463510059590941,0.461448564580026,0.456149706850014,0.450067158906855,0.44352948971582,0.441298226387206,0.43017917468986],"mode":"line","name":"val","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="stepwise.html#cb76-1"></a><span class="co"># Visualize the RMSE ####</span></span>
<span id="cb76-2"><a href="stepwise.html#cb76-2"></a><span class="co"># Extract the RMSE</span></span>
<span id="cb76-3"><a href="stepwise.html#cb76-3"></a>RMSE_val_max=RMSE_train_max=RMSE_val_min=RMSE_train_min=<span class="kw">c</span>()</span>
<span id="cb76-4"><a href="stepwise.html#cb76-4"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(results_jacknife)){</span>
<span id="cb76-5"><a href="stepwise.html#cb76-5"></a>  RMSE_val=<span class="kw">lapply</span>(results_jacknife[[k]],<span class="cf">function</span>(x) <span class="kw">unlist</span>(x<span class="op">$</span>RMSE_val))</span>
<span id="cb76-6"><a href="stepwise.html#cb76-6"></a>  RMSE_train=<span class="kw">lapply</span>(results_jacknife[[k]],<span class="cf">function</span>(x) <span class="kw">unlist</span>(x<span class="op">$</span>RMSE_train))</span>
<span id="cb76-7"><a href="stepwise.html#cb76-7"></a>  </span>
<span id="cb76-8"><a href="stepwise.html#cb76-8"></a>  <span class="co"># Get the maximum RMSE</span></span>
<span id="cb76-9"><a href="stepwise.html#cb76-9"></a>  RMSE_val_max_index=<span class="kw">which.max</span>(RMSE_val)</span>
<span id="cb76-10"><a href="stepwise.html#cb76-10"></a>  RMSE_val_max_i=RMSE_val[[RMSE_val_max_index]]</span>
<span id="cb76-11"><a href="stepwise.html#cb76-11"></a>  RMSE_train_max_i=RMSE_train[[RMSE_val_max_index]]</span>
<span id="cb76-12"><a href="stepwise.html#cb76-12"></a>  </span>
<span id="cb76-13"><a href="stepwise.html#cb76-13"></a>  RMSE_val_max=<span class="kw">c</span>(RMSE_val_max,RMSE_val_max_i)</span>
<span id="cb76-14"><a href="stepwise.html#cb76-14"></a>  RMSE_train_max=<span class="kw">c</span>(RMSE_train_max,RMSE_train_max_i)</span>
<span id="cb76-15"><a href="stepwise.html#cb76-15"></a>  </span>
<span id="cb76-16"><a href="stepwise.html#cb76-16"></a>  <span class="co"># Get the minimum RMSE</span></span>
<span id="cb76-17"><a href="stepwise.html#cb76-17"></a>  RMSE_val_min_index=<span class="kw">which.min</span>(RMSE_val)</span>
<span id="cb76-18"><a href="stepwise.html#cb76-18"></a>  RMSE_val_min_i=RMSE_val[[RMSE_val_min_index]]</span>
<span id="cb76-19"><a href="stepwise.html#cb76-19"></a>  RMSE_train_min_i=RMSE_train[[RMSE_val_min_index]]</span>
<span id="cb76-20"><a href="stepwise.html#cb76-20"></a>  </span>
<span id="cb76-21"><a href="stepwise.html#cb76-21"></a>  RMSE_val_min=<span class="kw">c</span>(RMSE_val_min,RMSE_val_min_i)</span>
<span id="cb76-22"><a href="stepwise.html#cb76-22"></a>  RMSE_train_min=<span class="kw">c</span>(RMSE_train_min,RMSE_train_min_i)</span>
<span id="cb76-23"><a href="stepwise.html#cb76-23"></a>}</span>
<span id="cb76-24"><a href="stepwise.html#cb76-24"></a></span>
<span id="cb76-25"><a href="stepwise.html#cb76-25"></a><span class="co"># Visualize the RMSE</span></span>
<span id="cb76-26"><a href="stepwise.html#cb76-26"></a>data2plot=<span class="kw">data.frame</span>(<span class="dt">set=</span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;val&quot;</span>,<span class="kw">length</span>(RMSE_val_max)),<span class="kw">rep</span>(<span class="st">&quot;train&quot;</span>,<span class="kw">length</span>(RMSE_val_max))),</span>
<span id="cb76-27"><a href="stepwise.html#cb76-27"></a>                     <span class="dt">index=</span><span class="kw">c</span>(<span class="kw">rev</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(RMSE_val_max)),<span class="kw">rev</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(RMSE_val_max))),</span>
<span id="cb76-28"><a href="stepwise.html#cb76-28"></a>                     <span class="dt">RMSE_max=</span><span class="kw">c</span>(<span class="kw">unlist</span>(RMSE_val_max),<span class="kw">unlist</span>(RMSE_train_max)),</span>
<span id="cb76-29"><a href="stepwise.html#cb76-29"></a>                     <span class="dt">RMSE_min=</span><span class="kw">c</span>(<span class="kw">unlist</span>(RMSE_val_min),<span class="kw">unlist</span>(RMSE_train_min)))</span>
<span id="cb76-30"><a href="stepwise.html#cb76-30"></a></span>
<span id="cb76-31"><a href="stepwise.html#cb76-31"></a>plotly<span class="op">::</span><span class="kw">plot_ly</span>(<span class="dt">data=</span>data2plot,</span>
<span id="cb76-32"><a href="stepwise.html#cb76-32"></a>                <span class="dt">x=</span><span class="op">~</span>index,</span>
<span id="cb76-33"><a href="stepwise.html#cb76-33"></a>                <span class="dt">y=</span><span class="op">~</span>RMSE_min,</span>
<span id="cb76-34"><a href="stepwise.html#cb76-34"></a>                <span class="dt">name =</span> <span class="op">~</span>set,</span>
<span id="cb76-35"><a href="stepwise.html#cb76-35"></a>                <span class="dt">type=</span><span class="st">&quot;scatter&quot;</span>,</span>
<span id="cb76-36"><a href="stepwise.html#cb76-36"></a>                <span class="dt">mode=</span><span class="st">&quot;line&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-18a5608058c0f450b57f" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-18a5608058c0f450b57f">{"x":{"visdat":{"47c911c037e6":["function () ","plotlyVisDat"]},"cur_data":"47c911c037e6","attrs":{"47c911c037e6":{"x":{},"y":{},"mode":"line","name":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"index"},"yaxis":{"domain":[0,1],"automargin":true,"title":"RMSE_min"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1],"y":[50.7081542875387,51.092755880281,51.3344961949211,51.4312871721322,51.6335946720472,51.7265019446705,51.8288425891943,51.8471291434135,51.8533857511885,51.9121420995353,51.9175585694911,52.0404844131679,52.0878833704749,52.0972108232074,52.1374138612592,52.2727515408156,52.3783173069583,52.3840305364794,52.3879022054974,52.4768018971357,52.5617132177983,52.562713775109,52.6110370990989,52.9703822280884,52.9752262940129,53.0208820434791,53.0390779052037,53.0728283098024,53.1933249418807,53.4922952362437,53.5793686174376,53.676179100871,53.7822756565905,53.88270788691,54.5733302333718,54.7864338521517,54.8334605855586,55.0184233427702,55.2058183415762],"mode":"line","name":"train","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1],"y":[66.1086637669376,65.6470671676923,65.3009863013862,65.0673104896826,64.9002699623185,64.7503233171891,64.6355071545136,64.5222465857433,64.4385793611202,64.3369458319301,64.2646488173377,64.1814136264165,64.0294005088522,63.8986496164153,63.8079060223651,63.760085046218,63.7107534078668,63.6745886848589,63.655932635453,63.6267516561677,63.5197436458985,63.5028569213539,63.4985360245581,63.4982445613652,63.5117256294001,63.5328319652062,63.6428783736901,63.6790047816533,63.7019406301172,63.7682074606361,63.8748954116243,63.993922611896,64.1705087272733,64.2980378101558,64.6159224364722,64.9825963300389,65.379246013568,65.4991513048793,66.1431702141745],"mode":"line","name":"val","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Based on the results above, the 31st iteration appears to provide a good balance between the sparsity of the formulation and the goodness of fit.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="stepwise.html#cb77-1"></a><span class="co"># Identify the specification ####</span></span>
<span id="cb77-2"><a href="stepwise.html#cb77-2"></a>step_chosen=<span class="dv">31</span>  </span>
<span id="cb77-3"><a href="stepwise.html#cb77-3"></a>r2_val=<span class="kw">lapply</span>(results_jacknife[[step_chosen]],<span class="cf">function</span>(x) <span class="kw">unlist</span>(x<span class="op">$</span>r2_val))</span>
<span id="cb77-4"><a href="stepwise.html#cb77-4"></a>r2_val_max_index=<span class="kw">which.max</span>(r2_val)</span>
<span id="cb77-5"><a href="stepwise.html#cb77-5"></a></span>
<span id="cb77-6"><a href="stepwise.html#cb77-6"></a>formula_selected=results_jacknife[[step_chosen]][[r2_val_max_index]]<span class="op">$</span>formula</span>
<span id="cb77-7"><a href="stepwise.html#cb77-7"></a>formula_selected</span></code></pre></div>
<pre><code>## pred/10 ~ -1 + intercept + chirps_ev_med + lights_med + dist2coast_r + 
##     pop_dens + lc_tree + dens_all_roads + dens_secondary + dens_bus + 
##     LZ_CentralIndusServ + f(ID, model = &quot;bym2&quot;, hyper = list(prec = list(prior = &quot;pc.prec&quot;, 
##     param = c(0.1, 0.0001)), phi = list(prior = &quot;pc&quot;, param = c(0.5, 
##     0.5))), graph = Segmento.Inla.nb, scale.model = TRUE, constr = T, 
##     adjust.for.con.comp = T)
## &lt;environment: 0x5632bcc57820&gt;</code></pre>
<p>Here are the covariates that were selected:</p>
<ul>
<li>chirps_ev_med: median precipitation</li>
<li>lights_med: median lights over the year</li>
<li>dist2coast_r: distance to coast</li>
<li>pop_dens: population density</li>
<li>lc_tree: percentage of trees</li>
<li>dens_all_roads: road density (all road categories)</li>
<li>dens_secondary: secondary road density</li>
<li>dens_bus : bus-lanes density</li>
<li>LZ_CentralIndusServ: Central Livelihood zones on industry and services</li>
</ul>
</div>
<div id="step-9-conduct-a-final-test" class="section level2">
<h2><span class="header-section-number">5.5</span> Step 9: Conduct a Final Test</h2>
<p>Lastly, we perform the final goodness-of-fit test on the test set. As a reminder, the test set contains 20 percent of the data we set aside before starting the selection process, meaning that the model has not yet seen them.</p>
<p>We start by building the data frame for estimating the final model with the training and test sets only.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="stepwise.html#cb79-1"></a><span class="co"># Build a data frame for the final test ####</span></span>
<span id="cb79-2"><a href="stepwise.html#cb79-2"></a>data_test=data_model</span>
<span id="cb79-3"><a href="stepwise.html#cb79-3"></a>data_test<span class="op">$</span>pred=data_test<span class="op">$</span>ingpe <span class="co"># Create prediction variables equal to ingpe, the outcome variable</span></span>
<span id="cb79-4"><a href="stepwise.html#cb79-4"></a><span class="co"># data_test$pred[index_test] &lt;- NA # Set the test prediction to NA: the variables will be predicted by the model and compared with observed </span></span>
<span id="cb79-5"><a href="stepwise.html#cb79-5"></a>data_test<span class="op">$</span>pred[<span class="kw">c</span>(index_test, index_val)] &lt;-<span class="st"> </span><span class="ot">NA</span> <span class="co"># Set the test prediction to NA: the variables will be predicted by the model and compared with observed </span></span>
<span id="cb79-6"><a href="stepwise.html#cb79-6"></a>data_test=data_test[<span class="kw">c</span>(index_test,index_train),]</span>
<span id="cb79-7"><a href="stepwise.html#cb79-7"></a></span>
<span id="cb79-8"><a href="stepwise.html#cb79-8"></a>index_train_bis=<span class="kw">which</span>(<span class="kw">is.na</span>(data_test<span class="op">$</span>pred)<span class="op">==</span>F)</span>
<span id="cb79-9"><a href="stepwise.html#cb79-9"></a>index_test_bis=<span class="kw">which</span>(<span class="kw">is.na</span>(data_test<span class="op">$</span>pred))</span></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="stepwise.html#cb80-1"></a>a &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb80-2"><a href="stepwise.html#cb80-2"></a>  <span class="dt">x =</span> <span class="dv">600</span>,</span>
<span id="cb80-3"><a href="stepwise.html#cb80-3"></a>  <span class="dt">y =</span> <span class="dv">100</span>,</span>
<span id="cb80-4"><a href="stepwise.html#cb80-4"></a>  <span class="dt">text =</span> <span class="kw">paste</span>(<span class="st">&quot;R2 training set:&quot;</span>,<span class="kw">round</span>(r2_train<span class="op">*</span><span class="dv">100</span>),<span class="st">&quot;%&quot;</span>,</span>
<span id="cb80-5"><a href="stepwise.html#cb80-5"></a>               <span class="st">&quot;</span><span class="ch">\n</span><span class="st">R2 test set:&quot;</span>,<span class="kw">round</span>(r2_test<span class="op">*</span><span class="dv">100</span>),<span class="st">&quot;%&quot;</span>,</span>
<span id="cb80-6"><a href="stepwise.html#cb80-6"></a>               <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb80-7"><a href="stepwise.html#cb80-7"></a>               <span class="st">&quot;</span><span class="ch">\n</span><span class="st">RMSE training set:&quot;</span>,<span class="kw">round</span>(RMSE_train),<span class="st">&quot;USD&quot;</span>,</span>
<span id="cb80-8"><a href="stepwise.html#cb80-8"></a>               <span class="st">&quot;</span><span class="ch">\n</span><span class="st">RMSE test set:&quot;</span>,<span class="kw">round</span>(RMSE_test),<span class="st">&quot;USD&quot;</span>),</span>
<span id="cb80-9"><a href="stepwise.html#cb80-9"></a>  </span>
<span id="cb80-10"><a href="stepwise.html#cb80-10"></a>  <span class="dt">xref =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb80-11"><a href="stepwise.html#cb80-11"></a>  <span class="dt">yref =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb80-12"><a href="stepwise.html#cb80-12"></a>  <span class="dt">showarrow =</span> F)</span></code></pre></div>
<p>The estimation is done with the usual <code>inla</code> function:</p>
<div class="figure" style="text-align: center"><span id="fig:test-bym2-chunk"></span>
<div id="htmlwidget-44951d5d4331cab78ecc" style="width:80%;height:288px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-44951d5d4331cab78ecc">{"x":{"visdat":{"47c932f10f41":["function () ","plotlyVisDat"]},"cur_data":"47c932f10f41","attrs":{"47c932f10f41":{"y":[160.597191078612,126.255751366667,115.386480766513,100.157644779674,96.2594008883409,108.721502262721,104.995499926746,105.102334109599,89.9603090079931,99.3339111283559,109.406819793762,102.445480903044,118.85181921111,93.8608951384248,112.546601735585,111.367478931195,98.6321496235682,103.622046363144,116.525716272872,187.205354058911,116.726178134841,98.3471718139523,99.0748955835125,92.5783640428621,111.477400725983,104.767441012283,104.287649606864,97.0510739060613,128.920272906317,130.875016661418,111.392875359123,134.575639258914,97.0320113183018,95.2210674357096,133.355478992671,92.549719685064,92.2973353598368,91.978044885216,103.575897982877,117.737105222496,101.192931737712,97.7050085519042,109.216620984103,97.5895102526531,91.2518500565048,99.5762721596351,228.343139260222,120.725634655502,91.0167697369182,169.382678062429,98.691979465105,98.0489709892657,156.351658119982,95.877911710594,156.642333805953,101.636188418296,97.3299672189144,112.21948018614,103.34974854104,120.416656853389,91.212736799362,156.061109744373,96.9141132773624,99.7459436428686,84.0065651113375,105.176961112603,116.69697062817,147.393741675806,115.795519932565,105.724800279049,92.4217132901092,107.0901477832,93.8315122998217,98.6231038446837,181.062551755919,107.474586206137,97.3177521531405,103.283903620345,98.1842750182831,183.949731708222,163.770936989523,99.1927907801758,129.344559165924,263.735587442745,104.275865411675,94.6863806647912,95.3121867967476,148.851254612342,141.798864993258,164.56064215534,181.525139977655,144.478389036908,136.763539511508,114.745264799143,117.423665972798,117.453593484894,150.999016783868,111.072308575858,124.29107034854,104.5428732233,247.373204225568,94.1605903329799,107.076546181951,162.98216944214,247.100993267973,151.444264375155,312.597863132312,144.244053089916,216.368234672483,106.891660157097,321.031295914933,205.543864950129,115.282907609114,130.644140131923,119.755888632418,105.627377956676,103.385379919831,130.418951086239,197.516474040382,98.6675815243312,137.749982251818,106.900587775981,107.751824970985,108.160459120764,120.42906148679,132.257757106046,96.9071271461507,114.311526246263,92.3091283132847,132.809820870585,109.371668857761,152.938893268253,154.685041826068,219.748635757069,147.336489707642,159.378836401116,89.3923681248473,147.563460325099,148.641529394961,162.065521708114,197.281794733981,102.336942284402,151.854643727097,128.735329158926,119.053185312892,137.247650896789,153.065302036305,132.132656723698,232.125871304835,93.3275701736345,92.8699446961733,124.200913284363,111.872420257614,94.3960578515204,95.4113756585672,97.6629126238529,95.392715305776,95.3812466334638,165.844776684595,94.1535047183434,93.2365017640459,103.711719710601,113.113838899254,99.3168044444915,176.237946664516,122.826857386352,83.9213556300448,95.1024992822369,187.673947976587,143.964692531756,126.619205605841,224.65875253896,164.715032274524,159.66664339569,80.4482320435404,172.437046759953,147.787118221501,114.375011813915,209.191200224979,111.634970393597,205.423993760251,107.048981296455,242.997142233035,118.394655310275,126.519767466285,206.905500296958,149.25381052805,150.428128137826,184.838830385575,161.081959569384,142.070018768056,209.12023516822,130.664263758629,127.020223252282,183.430739432122,176.816708471932,119.533801697022,218.841844233465,140.346253981718,104.688795207802,171.090960577027,173.589114470655,171.566991687112,158.210596621055,99.2979916223798,102.527993754156,219.053951926612,205.043791642277,236.385495368218,204.431920037312,179.524307633009,95.0551513176173,166.601153598134,192.033389988364,263.322339709092,127.291996047251,146.248251653181,172.904463186116,99.9273290533672,149.121450252889,173.593293223846,187.898306858689,100.963378942938,105.427639491666,108.16842787164,177.47501626444,138.132037434696,253.336912503617,143.649572723081,80.2924042723397,91.7675893449724,98.5021667960705,105.889758787599,195.456776080626,85.0815720350378,87.8215027116258,98.5321782186982,109.138167967231,90.8636716064353,101.67973344305,122.457298310755,132.256422128302,124.952325937998,86.2974999303256,118.575872898671,190.013887785078,94.3506160407332,195.802476516716,146.241098254789,186.477485086646,105.067425812623,99.2239098827471,109.140753489368,155.521737593996,134.997988404789,110.259088884628,106.626010826211,109.086696694408,106.057883476908,124.648040286607,137.643164034213,153.677353080069,156.421901147427,171.552463674055,106.227214389862,110.323544582523,162.283647675473,124.468552544402,105.352635509879,113.392727365541,118.17232933891,156.340453199318,96.1784855670958,107.111616416007,103.296540164247,136.563512202957,108.371666341411,105.676194104385,99.7532655276632,114.889426367133,107.916408137176,108.595580848097,109.194468599416,106.659776404144,108.281210549969,109.985347533891,114.57538682992,98.6303433588786,98.1295637350983,108.186230854434,99.4624347831873,107.588842248579,104.422114469411,126.236000169641,105.89313086663,119.671478178067,119.27743257844,120.764774024858,139.862067332341,98.9049087275148,91.9530831854468,91.6099812194204,111.793041182602,128.586576456091,153.574859873202,122.167911199113,107.17984562001,97.6764907868686,103.727735760944,144.172563349079,118.501547165073,99.594956070257,96.5065541983397,98.3129160792172,168.728639120782,172.122171445571,341.666449371567,109.450457912916,220.673675590778,265.254723833757,115.132190785428,163.986281215377,106.718677879044,108.453052431318,102.291830050761,104.301721590195,158.172612103384,134.399257456189,114.094124459782,100.119651640738,129.839167302743,103.830098382234,111.980588345137,106.717301131619,131.631838798009,151.809774926549,100.957639677726,106.301181213619,99.5994076603023,121.880888214543,104.27975057075,122.63771100268,95.9182733604716,110.466278894881,177.821934240177,92.1405848977924,94.2162910129823,93.281240157565,186.301565912507,142.549213237943,123.47938646334,120.25983193409,110.670074533479,209.130515968511,140.361631250941,164.077152926047,237.03268783841,231.4616241703,130.895862292075,147.526729739185,205.742229356154,118.833867626878,100.438280995151,101.91080576231,98.1001965122044,112.250418066536,105.182050994753,144.128456517724,96.6533740522366,96.526501040887,121.887708302205,111.409817606502,238.786471241637,103.443581455499,122.636385783619,112.358825239255,92.5909915164403,147.496884971683,92.8446844292206,93.4527379395653,147.815111023391,96.4395409075932,194.643979450305,148.993516706645,110.386996541638,87.9581682772747,200.304990003251,98.891185142188,201.30554146848,121.884644727624,110.320435248194,315.654454526314,271.851228920156,107.531223078903,139.644136824491,168.504035389358,145.212980641597,116.835803378565,124.175797405954,94.1378938655984,94.8455321042884,99.6086672478076,94.559964589325,95.880085525831,120.585631261525,95.7296965149366,125.091017137426,103.009214381559,101.000604105103,102.002921526337,116.629084474238,95.3088186163646,93.2140329768044,107.134637445609,135.628510444236,93.5657755345777,133.807160543919,146.180062613678,95.5855454484616,101.07555133221,104.350732482632,99.3564913847822,98.2231042967825,99.9096587821958,111.017969075539,93.2961058917938,126.024370661784,157.413168073885,150.367064198837,95.3018386774293,92.8243377962819,93.4913470046084,93.0306883920471,105.274276771513,164.793701527597,93.3789833481743,193.933080617498,98.0814029392357,100.764233564901,193.780136623388,102.236529521155,101.3623895943,96.9434604682237,101.179710516448,143.04267743056,96.8802501244157,121.055596116267,153.023459091056,148.650714383037,102.696209190742,91.9289956940721,97.1236702586122,87.9185696319382,128.212975227338,97.53737694818,112.678387710299,125.493058987654,173.032890629598,157.320977317573,131.357982582369,120.995819688523,95.9392354950018,96.5785372345977,94.6984671779891,93.7608530296264,93.5716116541791,97.2543406280025,111.717756443717,99.1481935242852,92.9560399777091,117.15765353732,91.7239148134261,98.164297644784,94.8385445996164,141.770770956497,115.081241014637,95.3735652089521,104.925583197019,156.344616368925,101.951836734076,119.299547630289,115.337233805211,102.141988369455,158.301592310854,148.127702107584,209.861234657432,149.113570280154,116.747891335309,94.5613551260343,126.453698202833,88.2165424528091,94.2133315711135,95.0088467749026,100.554063287644,89.6918085615738,90.6712610490389,114.953637975244,101.741084899668,157.305878044692,113.228363472976,93.074110157653,113.717069433592,117.524855852282,116.988098741368,116.744178747543,108.051348225399,147.709259220954,139.811409558163,92.7727979508074,103.107696068986,91.1722164186361,79.949823402543,166.894243567312,97.1308600881031,96.7662089709486,102.46560771445,134.922455907251,145.807839892639,98.966425261274,188.340038860693,166.827558335664,100.334785421416,103.182233740954,99.3343549489699,200.42514728855,124.544527248263,98.4546082972618,96.7828214660712,103.080877553761,97.8171505253539,96.8921437628259,101.80463223702,100.099067476377,132.963000363871,154.544101363288,131.622590360167,95.0975760031984,122.388614507976,101.202105639886,132.300532964532,119.815175169911,219.495046197909,178.822832899512,208.698890002192,296.398423528263,263.774715252428,127.071389437247,180.47853559031,105.925251863629,128.993665969231,130.542833252868,103.899934422628,103.913782113745,150.736953747839,148.614280018899,129.386206577141,145.839420011114,145.955519407517,105.324104677332,113.276699996918,131.849072419099,136.258347231974,137.474028203648,263.211679974298,212.205029166002,179.639986104193,163.737009950759,137.243648813175,147.113708848203,123.935062340815,100.263291991057,101.584776760959,183.263358666533,94.7776501348631,110.245945654511,108.941191128744,99.7266009495369,93.2238960746318,113.920845735653,136.916940748152,269.285791154705,256.928684839982,318.574086541347,363.284909242322,300.340590259402,336.362875087415,310.785418166657,130.784369750742,288.560225607611,352.736190532584,227.881656780338,104.145528555718,188.942568158841,217.251781766418,102.805941571522,106.294309532118,185.763763346424,122.915965714292,127.027368648532,116.160766411672,109.890735295832,116.967625688816,124.63255203942,114.107018439548,110.378259372322,192.846098002472,109.241102765955,124.42422641535,170.241906223626,111.545968319228,128.051790017537,112.37324507736,109.157865725474,107.970763186247,103.854530586913,181.06008418235,105.599518479535,110.74625973581,151.707236888286,227.916651704551,110.655670980972,118.428294710891,122.472184352066,105.257656278755,98.3204287768427,97.6712340436583,130.03576126012,110.353640679229,123.849819670979,109.592604669781,93.3174866585769,97.7854301665784,98.1949533830948,97.1881821316185,91.3442756774881,136.26613835708,247.853465288523,126.006789274823,101.947175750243,132.357783072437,141.926238587414,116.128044811941,131.823537356747,98.1355257282649,111.158686388881,92.4678230032355,94.2592588101167,122.740602895942,121.958458101676,175.339052326248,106.884473017765,113.12907141338,106.162298116793,93.1048002148444,96.6870781718815,101.484666209636,101.770555919927,145.268384108412,102.891631172885,101.637872395624,98.4765241737001,104.774033382341,107.49571062949,141.180014555684,175.122085047164,158.444331421794,106.524301129275,101.026014668571,87.5631505778478,108.065873368534,96.64225310878,93.0557077534084,152.48549817092,145.976163424226,189.906625609269,192.97136175303,117.123022538842,183.047737909855,218.898811596231,171.322412145271,227.765985725104,266.813984611516,239.865265812736,217.002602847582,106.799420517142,156.672538389953,144.880671831839,93.3252434244212,95.4450303501967,97.5116269799324,95.5224844240767,95.5523376547959,99.4516904187361,180.767134827199,140.687631285472,103.222882011357,109.288275476452,101.946649311979,96.7728235568661,123.92185543664,94.6705148666125,108.241485171324,98.9607596001162,93.1546838387422,110.201250476309,95.0378014583242,94.7245318496822,95.2847757648979,93.4439527662874,102.654775889275,118.251271238012,95.9476913098951,97.5106905345758,97.2538425269269,104.857327495861,95.1224793602714,95.3367853050442,102.060034822164,94.1772058557019,92.8605065042055,95.5267440408617,93.8948915165099,137.00961509864,113.032362954852,115.541494662037,105.949328886017,101.189876631546,96.6322918032022,111.566392013745,96.5190498648409,93.2125175738238,101.682378617878,111.559526435368,94.9027112853113,102.035523439312,93.1844678062602,106.881093252278,135.168080804318,120.105202555973,94.6796510276375,189.541519745226,110.603923899735,99.0709597287558,97.5874755179099,187.748068474129,99.6026127786687,128.539211926696,164.857114101102,88.84837914187,87.2603478538868,205.527577455609,169.814754609027,99.6603948759612,133.02143319358,101.59116728548,94.9619543189142,151.773093215056,243.558654416981,138.806801359989,105.716586602607,175.830491355995,223.415214343708,211.497685910685,168.404154549304,100.236636590374,146.3332887888,132.475502568426,262.521832736004,95.3834103866996,89.1287577233354,94.9138805596004,100.772254048531,91.3391113688802,188.666527087792,114.110354887549,205.06581158837,197.776858195326,227.63891493789,187.262482700675,118.780498410753,221.49507659225,176.621798486801,263.144877924763,270.917585917869,100.373199864507,261.337137975382,158.907257866401,169.426798401724,203.266634858784,135.462533782603,147.500858486619,187.480539713967,162.606539160241,192.527651082804,193.928808587014,242.843522031657,123.191199366192,158.401913684322,252.732140254876,119.180124207898,107.494628636965,168.847211983506,115.110651898276,229.202533976337,144.892692204449,167.040648604312,170.444885809616,115.36970492171,101.12964055205,170.260726452679,118.317179536812,170.890963361492,213.442399144753,125.724997916748,223.348785814036,112.966973757918,204.868536032904,108.937823652618,100.528497072979,113.429220882537,186.48549515861,111.367781542931,209.567967910124,295.424202503443,274.412505025722,244.584427083963,236.099066987256,107.801618376597,130.995007902379,92.6655915930704,107.000585778478,110.020654043059,237.151318281785,121.906306882046,121.588754642778,142.740723073782,104.157277607259,103.625161166777,263.473730779014,112.707021396639,122.448289075451,128.633560233439,137.637300718596,87.5034750727433,122.039961665907,125.495298408594,96.5506659540497,96.0786352384883,85.752827012013,83.111295666307,93.7800379660422,94.0805905970428,155.27592812268,167.899327808982,190.179481031526,166.236930396997,243.528748937889,121.58772128536,133.095899896143,185.797104162385,84.4733210005902,91.944734163327,93.7411294521867,140.667837371767,203.449034349635,113.533258103184,238.935938123015,142.995993771176,221.789159034247,195.08637256105,154.408642649986,234.699733280291,256.902591770429,104.101836215816,156.188550887841,160.772890954015,232.622735219931,234.404940764365,165.812802404336,114.368252411441,178.610556575323,151.8753995493,235.825450975121,130.07679256334,151.227982796198,109.640383044167,109.448051646116,105.819212479825,137.913785870811,110.797429950225,108.538845393659,125.127785391466,107.306767345963,101.254433300403,109.371295349551,131.803718215663,131.477307067555,128.132013223585,178.171644960419,128.809092416217,245.830239370157,164.656007968239,113.903884959005,178.036317309599,182.594086622028,164.762646986832,179.600632044263,197.711538132269,197.544625372126,206.696415050281,121.851798060332,128.935086648538,169.623487413967,167.681813111476,108.805270142696,279.701677512694,222.964139092551,219.023862103648,224.194034610117,111.049734123515,116.801625092191,117.463545160836,110.532529220112,161.3460354366,126.506841210867,91.9312768352822,142.893102627796,83.5690093738663,79.0797577280505,84.3663879587871,100.037272952542,100.096520382854,78.0205498794765,97.857213585853,96.1280748798673,94.1638054018279,98.1287675042101,101.41026141295,102.687492011419,111.731454469698,115.935485051422,271.361918908014,241.968892107901,152.991330174208,99.3694187565811,91.5424982148129,90.5959243989839,213.622746368973,117.232470069798,112.059591544578,139.309740355123,102.71319163118,83.7996086096397,86.8617636154316,99.9833082187974,84.6612625298699,94.3350984248802,80.5039305892849,82.1480472066697,184.300984828881,200.823017434485,83.1187858797141,113.710832277561,127.224461758153,182.540327622573,163.044953696565,123.698245730293,123.539181310029,153.321536757119,144.10461447662,187.39305371999,187.795624580829,94.3812524257557,112.59161423088,137.439394936708,146.223742391567,81.4670933712585,142.327235939174,212.546885091986,140.317195347628,166.76061847244,124.675860291018,177.203076810421,100.231867545452,101.418163705621,111.794660853054,116.675977228119,147.970831084991,107.203887889558,100.43952726382,125.24191775274,116.154884734783,133.79601835918,103.667378358349,116.173169109101,157.464647609136,129.710266615565,147.281620819769,116.048040383564,107.679434485666,111.814278263966,113.594103830642,118.436344788143,148.881840744506,109.151592632228,103.870241491983,119.268557071202,107.774300890092,111.209706176772,111.077376451669,139.009414292581,113.423155662171,115.671044125729,101.727300442841,142.522177607712,182.693568662872,112.782894014787,113.982904503591,112.544427593148,110.231418557966,105.142456061292,110.547797786105,149.675828765488,104.820955549418,101.773363227597,109.344842509262,117.108627932601,106.666746779708,102.165622311337,156.347950723782,199.067569478347,168.701417916788,113.84275597379,180.848131046561,162.516571619673,172.504367690783,120.002508747888,107.750131672473,144.541924426354,113.635431902618,183.89727972225,161.114461948446,111.587669821085,160.897197698324,175.454044878766,140.138392423445,153.139251705003,180.317744493398,110.074529986736,133.876395682318,111.079489826932,102.177058608507,170.203718895902,111.742298314609,149.535036988464,129.20415112595,106.272677350719,126.598693578321,103.204792631472,105.952926454815,96.0593096927366,111.103941690024,98.3015780726957,109.936912178239,115.864759945743,112.678327023389,112.511246108629,144.695501910049,120.559128565707,135.046883103423,177.846072329443],"x":[197.2,139.06,82.655,85.62,70.415,80.5,63.47,81.635,62.9,125,102.43,105.08,171.94,71.11,87.61,151.67,93.67,184.85,152.78,189.55,164.94,98.135,56.72,67.14,140,51.56,134.71,36.68,243.715,198.33,160.4,170.23,87.63,53.44,253.12,46.28,53.14,43.49,51.13,128.42,102.78,97.14,156.27,85.31,73.43,80.04,174.69,183.45,62.57,239.73,49.57,67.87,237.47,61.2,128.63,111.96,109.1,193.53,157.87,142.38,65.34,158.61,93.61,101.33,72.57,142.92,173.67,270.83,119.42,191.39,77.4,83.57,156.745,58.29,289,216.93,69.88,112.99,109.44,172.87,101.665,113.97,115.5,753.31,142.98,64.475,65.54,147.08,215.03,150,175.86,198.38,143.62,74.12,70,104.72,215,179.06,137.45,54.9,282.64,160.61,111.5,226.565,356.16,143.35,92.96,126.92,164.17,145.96,423.9,179.02,65.08,132.8,161.225,94.97,114.92,113.95,325.53,110.63,165.05,74.415,57.6,112.735,114.86,175,53,103,42.61,160,115.14,103.3,138.75,176.875,225.88,79.6,68.8,93.1,143,132,107.01,69.38,106.33,171.13,91.67,128.17,146,84.17,240.67,51.7,58.45,153.45,115.67,53.17,88.15,65,90.475,33.05,170.39,71.06,57.15,127.97,98.34,108.84,154.015,155.86,75.315,49.56,148.33,123,173.64,114.9,200.75,130.58,87.5,259.25,102.67,79.29,137.92,106.31,191.33,111.455,133.11,84.67,91.27,176.53,147.43,144.32,81.25,88.33,241.81,392.2,106.19,142.54,78.33,228.65,125,250.16,177.49,105,267,248.35,171.94,121.96,84.35,90.19,183.79,116.78,215.65,258.95,129.35,108.33,121.75,136.135,477.27,97.515,125,108.39,114.86,119.725,113.25,210.48,93.55,73.23,177.91,279.24,106.37,171.43,111.265,52,94.015,102.81,120.71,158.86,67.71,55.82,56.25,155.945,165.58,100.29,123.905,226.52,121.11,90.95,200.51,189.075,170.9,208.82,119.24,141.31,89.23,101.69,92.83,150.585,101.39,108.33,103.515,78.66,89.17,100.28,75.83,135,137.17,173.05,70.89,75.84,204.89,88.75,45.83,129.24,188.69,96.26,75.46,97.36,87.97,154,65,116.38,73.78,120.88,82.47,127.31,60.13,148.17,118.51,143.89,102.74,107.99,35.175,69.07,116.29,74.955,128.905,133.33,111.2,142.29,162.78,123.25,100,113.03,56.88,37.04,76.61,104.38,285.99,135,74.31,95.56,67.5,164.165,94.62,62.82,73.48,109.32,130,76.08,381.34,153.75,178.06,122.11,71.67,123.43,54.17,80.75,53.33,125.345,194.92,281.77,141.35,124.75,153.74,143.39,93.285,86,160,238.67,53.29,72.38,112.51,181.99,116.57,100.63,80.83,91.25,82.69,87.475,53.61,98.355,142.5,156.79,80,144.6,124.51,242.26,303.02,106.815,250.79,244.5,119.75,132.06,284.54,175.21,98.88,108.33,109.88,129.58,118.33,105.32,82.21,87.17,61.42,47.62,125,89.44,235.645,82.08,65.955,263.9,32.24,99.69,185.83,94.33,398.78,245.04,158.89,70.3,156.77,121.17,210.82,112.52,80.55,446.06,297.62,136.2,157.58,123.28,134.785,153.22,100,112.65,125.23,99.09,54.86,57.13,241.445,32.21,93.19,94.79,78.91,129,99.14,82,33.61,100.91,109.52,48.32,201.51,121.46,65.21,65,72.92,56.41,76.99,97.66,100,68.83,154.15,203.12,124.61,78.615,131.53,68.96,117,150,160.01,92.59,160.02,129.77,90.36,195.22,141.22,96.55,74.32,91.71,208.29,85.29,109.3,129,119.33,99.42,84.27,76.65,58.73,88.09,136.5,130.18,96.67,190.25,135.91,86.1,129.47,130.51,91.54,56.63,67.4,52.11,92.12,154.88,45.42,99.19,100.82,53.54,55.75,81.5,180.25,137.61,86.94,116.67,325,99.65,124.25,136.36,160.97,100,147.5,138.68,145.315,191.67,108,150,61.06,91.44,56.72,140.95,117.67,70.96,112.14,105.14,260.98,156.19,92.97,84.11,142.03,73.67,152.54,117.29,215,139.05,117.64,108.03,81.49,47.955,126.71,110,112.9,69.34,139.58,95,167.15,246,181.25,149.07,180.25,66.54,106.99,139.1,89.06,76.43,139.39,108.23,74.86,59.39,98.17,174.29,278.11,84.69,122.55,180.67,113.43,133.13,156.25,302.07,165.17,136.25,342.75,228.75,184.815,120,108.33,186.39,114.895,115.84,86.8,163.46,116.94,121.39,97.73,125.27,104.015,83.31,116.165,144,194.98,432.92,482.33,168.41,120.73,102.54,140.2,118.25,80.44,136.21,254.15,113.655,121.67,95.63,53.97,32.605,118.67,174.37,395.44,879.9,375,266.67,483.21,533.61,203.17,116.39,425.995,141.6,481.02,90,143.75,184.47,117.67,90.68,208.66,91.73,151.94,116.04,95.88,113.615,173.1,132.85,98.18,100,176.39,126.25,133.75,115.23,123.59,91.23,87.75,89,136.67,217.5,60.76,74.91,126.81,276.73,114.55,72.585,89.12,84.95,44.48,64.43,149.61,100.83,124.33,128.06,43.18,68.13,105.19,107.38,39.44,201.4,164.79,200.305,81.4,155.15,191.25,163.56,90.06,68.06,139.21,43.33,88.515,201.43,112.5,249.55,62.86,120.55,116.02,129.54,99.6,92.78,99.71,333.34,84.93,87.18,75.56,118.215,189.91,190.35,285.75,203.95,107.14,87.54,58.75,112.96,119.58,51.13,240.41,120,185.27,125,95.96,296.46,194.96,166.67,219.26,293.97,360,259.38,70.9,106.25,116.5,110.96,73.15,98.23,67.5,139,68.19,169.78,148.75,98.6,82.11,154.97,89.78,75.75,45.57,171.61,107.96,56.11,125.775,117.38,116.97,125.365,71.47,260.21,85,75.33,73.83,104.4,120.67,77.12,99.42,101.575,131.46,107.5,113.33,55.96,250.42,155.17,79.63,98.02,97.25,167.475,94.9,42.96,152.6,64.23,110.915,58.25,102.59,89.89,69.48,111.19,169.16,80.33,163.34,52,91.25,103.75,295.73,125.305,145,194.04,133.61,77.095,396.91,235.53,154.59,65.835,119.13,80.88,117.07,155.88,151.41,58.03,200.89,246.75,329.815,150.66,84.71,143,112.32,100,97.92,54.97,80.665,97.5,58.14,104.72,131.01,111.165,181.295,181.05,118.33,87.79,175.5,166.78,314.68,173.17,116.46,218.33,134.38,159.13,214.39,128.37,124.03,146.31,120.25,265.1,184.17,163.92,75.67,236.655,279.83,176.78,70.42,116.33,121.48,141.05,137.78,146.66,215.36,91.825,136.85,129.75,156.54,130,231.02,130,302.92,87.395,188.35,104.55,111.31,78.54,151.38,93.58,191.24,215.71,328.275,256.67,205.22,119.67,118.75,96.92,76.98,55.58,201.38,189.76,97.5,132.17,98.79,65.16,80,104.73,96.915,123.17,156.2,38.47,87.25,160.105,173.55,126.205,106.92,94.55,136.67,74.44,173.41,191.19,160.88,127.67,184.77,94.82,125.03,194.32,67.24,68.7,115.325,118.33,269.78,67.92,126.67,131.2,254.15,126.69,135.56,159.96,220,79.17,340.205,190.13,332.34,121.82,210.6,107.6,187.24,140.19,336.235,87.61,136.49,95.36,77.14,95.86,129.86,66.64,79.82,196.48,62.28,139.84,122.14,139.67,120.92,100.68,247.025,102.635,212.685,190.99,107.67,166.67,139.85,92.005,233.92,145.91,156.875,255.71,150.3,59.46,279.3,111.46,81.455,265,136.56,174.53,310.96,105.43,109.71,78.01,93.52,147.72,102.78,67.33,132.56,62.44,71.03,116.67,74.78,147.985,109.33,120.79,100.07,93.605,64.65,137.44,118.77,144.06,119.675,197.64,256.685,110.84,75.64,52.25,96.47,175,146.88,113.97,200,131.315,50.33,92.71,90.48,92.08,113.49,84.19,76.105,197.98,173,74.46,178.06,159.96,152.5,153.665,128.84,83.19,211.11,138.46,90.61,132.52,99.44,194.52,140.95,149.58,100,213.33,228.03,118.75,188.62,108.5,196.08,74.92,56.68,111.76,88.05,129.02,48.86,50.27,126.81,58.18,188.44,123.86,69.88,94,224.94,142.78,86.67,63.89,58.36,131.35,90.27,187.335,76.64,53.04,143.4,64.29,93.92,167.63,223.04,108.8,90.175,135,148.31,202.75,119.31,100.84,145.14,75.86,51.95,88.37,250,98.83,77.88,93.47,100,49.57,75.63,248,207.65,91.56,81.67,117,178.28,215.23,106.13,74.03,191.07,123.63,118.92,176.11,115.84,218.32,251.13,261.16,161.11,229.05,65.07,241.1,84.88,95.08,225,90.86,300,160,168.33,101.04,131.63,108.29,119.9,73.36,74,89.625,105.055,136.39,98.05,112.515,112.67,86.85,237.39],"mode":"markers","marker":{"color":"black","opacity":0.3},"name":"training set","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"47c932f10f41.1":{"y":[91.8363405487808,114.64214506328,183.899453814878,114.108380371469,134.877254114472,97.0564157473747,146.746598405243,113.853041081552,111.432486640218,95.9493254897739,106.209913621131,94.5879050907877,120.327296392176,90.6880968117381,231.259976392095,113.288548823804,149.064831473469,110.649208653329,196.672647020687,385.554065482008,349.23915189874,99.6193124594069,180.633079515358,169.655707490586,120.238246796991,120.504531706445,143.192891330761,172.106728822303,97.4919621550684,180.897007307782,101.616840247609,170.874921761676,99.4214221417552,112.197115474145,138.810810199574,236.638734651949,103.67112119778,177.175744217454,94.3276098288616,157.669324307857,255.84487378524,135.668901355554,112.186486061459,268.141944343011,114.344216892394,97.6880973301588,80.291201762174,81.7079924466272,105.159533838766,116.906292939054,130.177219852026,101.281090588124,123.731087098366,111.808567051805,118.098178749571,173.930287792714,116.571330938581,174.729683317019,109.697903277319,108.020350970676,103.728227385713,121.388718687465,108.710581392963,89.2474027532763,114.094646324825,170.129568458489,103.459762840002,219.863732701375,96.5633515949121,114.30928040432,151.7887429466,101.108675059509,97.1385766354928,126.163370790647,147.273409530196,108.788632659669,99.6709931037544,114.33248743574,216.690003432267,95.1480970018468,101.795829069032,121.85990106421,107.86709070159,120.605025477235,157.078844676156,96.9726762408548,94.3324233410104,114.47250222698,136.775312464769,107.081644914553,164.816195095432,98.7990720945475,158.071340061761,188.033610261158,185.812414812076,154.811023878766,166.210707010873,97.3994301255069,139.916251126855,113.705106782015,97.9927721023758,96.0434892808364,95.7133848526123,93.0431632619265,91.5000957159939,89.7706795069684,94.2295440237818,90.3081566171478,124.886317622378,104.397878526416,90.8954679364136,113.972406406959,94.8800557748006,137.272046899843,124.455094964403,135.175624994717,124.829626757145,96.7959605115949,108.850831401184,142.285531446038,99.4876756403781,99.2526527537294,274.532058197767,185.739310683509,141.854083787764,123.017839977356,98.343909266444,135.692234375628,127.918689735582,157.153586003976,260.503954772674,139.858575474424,138.465541093825,168.701593730254,111.866477940247,117.509646544776,258.832002817556,283.63810343886,176.205310400624,138.689636012119,110.848047611733,129.434522306551,160.31528043586,111.611696629595,102.839871297709,97.8091249045005,365.705815118896,115.128078444689,106.004453249028,204.902621868281,180.332191159681,304.200075849588,90.5476912221243,139.311860050021,129.057662050782,108.54442607294,180.297339709818,85.952539594083,146.169462742567,217.30121889958,247.91094305947,183.166863495179,95.5061618679316,234.250453682236,89.6289883451758,97.4247993842555,102.173005203965,114.712577339245,125.525289112397,93.5074057339823,153.849252488079,92.125764964172,98.179932657903,95.676911564285,115.732328697863,96.7093666977565,117.032178002481,141.851151469984,110.179105545696,96.4836576607269,133.283354272407,99.5201453786548,181.056311555418,101.982255244215,97.0974123974823,102.442072783719,80.7243992881689,211.657444768946,90.018844288651,116.997137604629,117.675354923658,149.958670545536,137.828785546934,104.735840061909,220.419795565759,269.011315919587,131.805413763401,108.282154659471,168.647802388382,146.570279158525,162.712706671,114.442346353104,98.8532139655056,121.334713768031,156.736383052818,145.546971204928,201.981173302072,161.837636815664,102.616130542136,79.515529104116,178.727773193071,171.072480390902,145.549995450726,120.578053595148,230.061529911329,212.21431913919,81.4829451252262,152.809291832496,93.697606946677,98.0546882891745,205.726762316935,271.898041403515,313.299530263916,209.219013697862,154.480972956812,259.664241818119,182.897534707642,139.550944421081,200.639925490356,81.1094351579792,103.600284191228,100.290957012597,81.5295008283155,97.5420172239539,121.846559150577,183.244896946558,118.206208716098,142.162260482059,109.197406467268,102.777118769977,177.925071078392,99.1023044719598,139.108128735286,140.493106046846,106.011370505039,98.6901654145564,118.528497321976,105.186147016622,117.837313023617,113.91133239735,99.6299617920372,110.934320955968,112.693033477172,203.087647848881,105.061848015804,189.092137294673,134.379211760345,189.084876737308,113.996649807095,120.358391771558,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"x":[111.94,156,320.66,111.32,174.375,64.25,200,175.34,120.94,42.29,98.2,53.3,193.945,87.4,128.33,141.28,145,125.73,127.54,281.09,191.21,50.73,101.39,114,81.94,101.39,128.32,251.46,71.49,197.73,72.885,200.22,162.83,132.15,184.17,192.08,143.92,208,88.54,184.38,265.43,140.94,131.9,241.88,93.89,127.5,51.13,95.42,111.87,87.56,157.38,58.78,146.98,92.43,116.38,243.33,132.5,281.34,84.27,65.04,131.39,108.61,101.11,82.17,117.67,178.33,95.81,403.82,122.15,179.66,122.54,66.32,83.98,150.17,251.25,92.17,76.605,123,150.18,129.17,187.5,112.11,104.855,131.4,124.46,56.42,60.43,127.73,176.44,110.71,118.11,129.89,127.56,250,126.32,129.99,205.56,75.5,97.56,164.53,92.5,60.23,105.46,45.15,101.45,63.26,141.2,112.5,179.81,77.52,123.31,73.37,70.51,108.51,89.35,105.14,236.32,69.62,165.83,124.27,112.64,127.34,291.06,236.58,203.34,122.78,70.29,138.6,115.255,258.21,158,147.56,153.43,125.49,108.34,78.73,168.95,227.94,177.86,143.77,81.67,111.84,134.13,132.57,68.78,75,211.87,136.385,66.33,234.95,151.19,165.975,46.18,205.83,123.335,116.45,65.62,49.78,118.445,117.81,194.03,199.33,88.33,157.44,40.615,108.83,158.17,208.65,180,81.31,160.14,68.63,75.13,73.83,80.73,103.94,89.56,200,204.17,66.94,127.88,68.27,115.83,133.33,91.76,102.52,75.34,230.35,162.68,90.81,129.9,158.56,208.84,53.61,169.08,175,133.64,98.835,152.5,108.3,160.67,114.44,113.94,194.445,214.62,145,113.43,156.31,58.27,129.02,145.86,121.62,203.4,100.675,244.17,173,165.92,207.08,51.78,93.92,290.63,115.92,217.34,224.38,162.76,275.57,277.81,232.07,136.78,57.96,135.49,71.33,73.05,85.86,91.53,69.33,91.85,92.63,90.83,76.28,234.76,73.08,151.3,100.75,89.605,86.32,161.94,115.15,121.84,95.67,134.95,155.67,67.64,143.93,89.21,177.69,158.45,186.33,128.45,50.42,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"mode":"markers","marker":{"color":"red","opacity":0.3},"name":"validation set","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true},"47c932f10f41.2":{"y":[0,880],"x":[0,880],"mode":"lines","marker":{"color":"black","opacity":0.3},"name":"1:1","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"yaxis":{"domain":[0,1],"automargin":true,"range":[0,510],"title":"Predicted (USD)"},"xaxis":{"domain":[0,1],"automargin":true,"range":[0,880],"title":"Observed (USD)"},"annotations":[{"x":600,"y":100,"text":"R2 training set: 45 % <br />R2 test set: 40 % <br /> <br />RMSE training set: 54 USD <br />RMSE test set: 57 USD","xref":"x","yref":"y","showarrow":false}],"title":"Income at the Segmento Level","hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"y":[160.597191078612,126.255751366667,115.386480766513,100.157644779674,96.2594008883409,108.721502262721,104.995499926746,105.102334109599,89.9603090079931,99.3339111283559,109.406819793762,102.445480903044,118.85181921111,93.8608951384248,112.546601735585,111.367478931195,98.6321496235682,103.622046363144,116.525716272872,187.205354058911,116.726178134841,98.3471718139523,99.0748955835125,92.5783640428621,111.477400725983,104.767441012283,104.287649606864,97.0510739060613,128.920272906317,130.875016661418,111.392875359123,134.575639258914,97.0320113183018,95.2210674357096,133.355478992671,92.549719685064,92.2973353598368,91.978044885216,103.575897982877,117.737105222496,101.192931737712,97.7050085519042,109.216620984103,97.5895102526531,91.2518500565048,99.5762721596351,228.343139260222,120.725634655502,91.0167697369182,169.382678062429,98.691979465105,98.0489709892657,156.351658119982,95.877911710594,156.642333805953,101.636188418296,97.3299672189144,112.21948018614,103.34974854104,120.416656853389,91.212736799362,156.061109744373,96.9141132773624,99.7459436428686,84.0065651113375,105.176961112603,116.69697062817,147.393741675806,115.795519932565,105.724800279049,92.4217132901092,107.0901477832,93.8315122998217,98.6231038446837,181.062551755919,107.474586206137,97.3177521531405,103.283903620345,98.1842750182831,183.949731708222,163.770936989523,99.1927907801758,129.344559165924,263.735587442745,104.275865411675,94.6863806647912,95.3121867967476,148.851254612342,141.798864993258,164.56064215534,181.525139977655,144.478389036908,136.763539511508,114.745264799143,117.423665972798,117.453593484894,150.999016783868,111.072308575858,124.29107034854,104.5428732233,247.373204225568,94.1605903329799,107.076546181951,162.98216944214,247.100993267973,151.444264375155,312.597863132312,144.244053089916,216.368234672483,106.891660157097,321.031295914933,205.543864950129,115.282907609114,130.644140131923,119.755888632418,105.627377956676,103.385379919831,130.418951086239,197.516474040382,98.6675815243312,137.749982251818,106.900587775981,107.751824970985,108.160459120764,120.42906148679,132.257757106046,96.9071271461507,114.311526246263,92.3091283132847,132.809820870585,109.371668857761,152.938893268253,154.685041826068,219.748635757069,147.336489707642,159.378836401116,89.3923681248473,147.563460325099,148.641529394961,162.065521708114,197.281794733981,102.336942284402,151.854643727097,128.735329158926,119.053185312892,137.247650896789,153.065302036305,132.132656723698,232.125871304835,93.3275701736345,92.8699446961733,124.200913284363,111.872420257614,94.3960578515204,95.4113756585672,97.6629126238529,95.392715305776,95.3812466334638,165.844776684595,94.1535047183434,93.2365017640459,103.711719710601,113.113838899254,99.3168044444915,176.237946664516,122.826857386352,83.9213556300448,95.1024992822369,187.673947976587,143.964692531756,126.619205605841,224.65875253896,164.715032274524,159.66664339569,80.4482320435404,172.437046759953,147.787118221501,114.375011813915,209.191200224979,111.634970393597,205.423993760251,107.048981296455,242.997142233035,118.394655310275,126.519767466285,206.905500296958,149.25381052805,150.428128137826,184.838830385575,161.081959569384,142.070018768056,209.12023516822,130.664263758629,127.020223252282,183.430739432122,176.816708471932,119.533801697022,218.841844233465,140.346253981718,104.688795207802,171.090960577027,173.589114470655,171.566991687112,158.210596621055,99.2979916223798,102.527993754156,219.053951926612,205.043791642277,236.385495368218,204.431920037312,179.524307633009,95.0551513176173,166.601153598134,192.033389988364,263.322339709092,127.291996047251,146.248251653181,172.904463186116,99.9273290533672,149.121450252889,173.593293223846,187.898306858689,100.963378942938,105.427639491666,108.16842787164,177.47501626444,138.132037434696,253.336912503617,143.649572723081,80.2924042723397,91.7675893449724,98.5021667960705,105.889758787599,195.456776080626,85.0815720350378,87.8215027116258,98.5321782186982,109.138167967231,90.8636716064353,101.67973344305,122.457298310755,132.256422128302,124.952325937998,86.2974999303256,118.575872898671,190.013887785078,94.3506160407332,195.802476516716,146.241098254789,186.477485086646,105.067425812623,99.2239098827471,109.140753489368,155.521737593996,134.997988404789,110.259088884628,106.626010826211,109.086696694408,106.057883476908,124.648040286607,137.643164034213,153.677353080069,156.421901147427,171.552463674055,106.227214389862,110.323544582523,162.283647675473,124.468552544402,105.352635509879,113.392727365541,118.17232933891,156.340453199318,96.1784855670958,107.111616416007,103.296540164247,136.563512202957,108.371666341411,105.676194104385,99.7532655276632,114.889426367133,107.916408137176,108.595580848097,109.194468599416,106.659776404144,108.281210549969,109.985347533891,114.57538682992,98.6303433588786,98.1295637350983,108.186230854434,99.4624347831873,107.588842248579,104.422114469411,126.236000169641,105.89313086663,119.671478178067,119.27743257844,120.764774024858,139.862067332341,98.9049087275148,91.9530831854468,91.6099812194204,111.793041182602,128.586576456091,153.574859873202,122.167911199113,107.17984562001,97.6764907868686,103.727735760944,144.172563349079,118.501547165073,99.594956070257,96.5065541983397,98.3129160792172,168.728639120782,172.122171445571,341.666449371567,109.450457912916,220.673675590778,265.254723833757,115.132190785428,163.986281215377,106.718677879044,108.453052431318,102.291830050761,104.301721590195,158.172612103384,134.399257456189,114.094124459782,100.119651640738,129.839167302743,103.830098382234,111.980588345137,106.717301131619,131.631838798009,151.809774926549,100.957639677726,106.301181213619,99.5994076603023,121.880888214543,104.27975057075,122.63771100268,95.9182733604716,110.466278894881,177.821934240177,92.1405848977924,94.2162910129823,93.281240157565,186.301565912507,142.549213237943,123.47938646334,120.25983193409,110.670074533479,209.130515968511,140.361631250941,164.077152926047,237.03268783841,231.4616241703,130.895862292075,147.526729739185,205.742229356154,118.833867626878,100.438280995151,101.91080576231,98.1001965122044,112.250418066536,105.182050994753,144.128456517724,96.6533740522366,96.526501040887,121.887708302205,111.409817606502,238.786471241637,103.443581455499,122.636385783619,112.358825239255,92.5909915164403,147.496884971683,92.8446844292206,93.4527379395653,147.815111023391,96.4395409075932,194.643979450305,148.993516706645,110.386996541638,87.9581682772747,200.304990003251,98.891185142188,201.30554146848,121.884644727624,110.320435248194,315.654454526314,271.851228920156,107.531223078903,139.644136824491,168.504035389358,145.212980641597,116.835803378565,124.175797405954,94.1378938655984,94.8455321042884,99.6086672478076,94.559964589325,95.880085525831,120.585631261525,95.7296965149366,125.091017137426,103.009214381559,101.000604105103,102.002921526337,116.629084474238,95.3088186163646,93.2140329768044,107.134637445609,135.628510444236,93.5657755345777,133.807160543919,146.180062613678,95.5855454484616,101.07555133221,104.350732482632,99.3564913847822,98.2231042967825,99.9096587821958,111.017969075539,93.2961058917938,126.024370661784,157.413168073885,150.367064198837,95.3018386774293,92.8243377962819,93.4913470046084,93.0306883920471,105.274276771513,164.793701527597,93.3789833481743,193.933080617498,98.0814029392357,100.764233564901,193.780136623388,102.236529521155,101.3623895943,96.9434604682237,101.179710516448,143.04267743056,96.8802501244157,121.055596116267,153.023459091056,148.650714383037,102.696209190742,91.9289956940721,97.1236702586122,87.9185696319382,128.212975227338,97.53737694818,112.678387710299,125.493058987654,173.032890629598,157.320977317573,131.357982582369,120.995819688523,95.9392354950018,96.5785372345977,94.6984671779891,93.7608530296264,93.5716116541791,97.2543406280025,111.717756443717,99.1481935242852,92.9560399777091,117.15765353732,91.7239148134261,98.164297644784,94.8385445996164,141.770770956497,115.081241014637,95.3735652089521,104.925583197019,156.344616368925,101.951836734076,119.299547630289,115.337233805211,102.141988369455,158.301592310854,148.127702107584,209.861234657432,149.113570280154,116.747891335309,94.5613551260343,126.453698202833,88.2165424528091,94.2133315711135,95.0088467749026,100.554063287644,89.6918085615738,90.6712610490389,114.953637975244,101.741084899668,157.305878044692,113.228363472976,93.074110157653,113.717069433592,117.524855852282,116.988098741368,116.744178747543,108.051348225399,147.709259220954,139.811409558163,92.7727979508074,103.107696068986,91.1722164186361,79.949823402543,166.894243567312,97.1308600881031,96.7662089709486,102.46560771445,134.922455907251,145.807839892639,98.966425261274,188.340038860693,166.827558335664,100.334785421416,103.182233740954,99.3343549489699,200.42514728855,124.544527248263,98.4546082972618,96.7828214660712,103.080877553761,97.8171505253539,96.8921437628259,101.80463223702,100.099067476377,132.963000363871,154.544101363288,131.622590360167,95.0975760031984,122.388614507976,101.202105639886,132.300532964532,119.815175169911,219.495046197909,178.822832899512,208.698890002192,296.398423528263,263.774715252428,127.071389437247,180.47853559031,105.925251863629,128.993665969231,130.542833252868,103.899934422628,103.913782113745,150.736953747839,148.614280018899,129.386206577141,145.839420011114,145.955519407517,105.324104677332,113.276699996918,131.849072419099,136.258347231974,137.474028203648,263.211679974298,212.205029166002,179.639986104193,163.737009950759,137.243648813175,147.113708848203,123.935062340815,100.263291991057,101.584776760959,183.263358666533,94.7776501348631,110.245945654511,108.941191128744,99.7266009495369,93.2238960746318,113.920845735653,136.916940748152,269.285791154705,256.928684839982,318.574086541347,363.284909242322,300.340590259402,336.362875087415,310.785418166657,130.784369750742,288.560225607611,352.736190532584,227.881656780338,104.145528555718,188.942568158841,217.251781766418,102.805941571522,106.294309532118,185.763763346424,122.915965714292,127.027368648532,116.160766411672,109.890735295832,116.967625688816,124.63255203942,114.107018439548,110.378259372322,192.846098002472,109.241102765955,124.42422641535,170.241906223626,111.545968319228,128.051790017537,112.37324507736,109.157865725474,107.970763186247,103.854530586913,181.06008418235,105.599518479535,110.74625973581,151.707236888286,227.916651704551,110.655670980972,118.428294710891,122.472184352066,105.257656278755,98.3204287768427,97.6712340436583,130.03576126012,110.353640679229,123.849819670979,109.592604669781,93.3174866585769,97.7854301665784,98.1949533830948,97.1881821316185,91.3442756774881,136.26613835708,247.853465288523,126.006789274823,101.947175750243,132.357783072437,141.926238587414,116.128044811941,131.823537356747,98.1355257282649,111.158686388881,92.4678230032355,94.2592588101167,122.740602895942,121.958458101676,175.339052326248,106.884473017765,113.12907141338,106.162298116793,93.1048002148444,96.6870781718815,101.484666209636,101.770555919927,145.268384108412,102.891631172885,101.637872395624,98.4765241737001,104.774033382341,107.49571062949,141.180014555684,175.122085047164,158.444331421794,106.524301129275,101.026014668571,87.5631505778478,108.065873368534,96.64225310878,93.0557077534084,152.48549817092,145.976163424226,189.906625609269,192.97136175303,117.123022538842,183.047737909855,218.898811596231,171.322412145271,227.765985725104,266.813984611516,239.865265812736,217.002602847582,106.799420517142,156.672538389953,144.880671831839,93.3252434244212,95.4450303501967,97.5116269799324,95.5224844240767,95.5523376547959,99.4516904187361,180.767134827199,140.687631285472,103.222882011357,109.288275476452,101.946649311979,96.7728235568661,123.92185543664,94.6705148666125,108.241485171324,98.9607596001162,93.1546838387422,110.201250476309,95.0378014583242,94.7245318496822,95.2847757648979,93.4439527662874,102.654775889275,118.251271238012,95.9476913098951,97.5106905345758,97.2538425269269,104.857327495861,95.1224793602714,95.3367853050442,102.060034822164,94.1772058557019,92.8605065042055,95.5267440408617,93.8948915165099,137.00961509864,113.032362954852,115.541494662037,105.949328886017,101.189876631546,96.6322918032022,111.566392013745,96.5190498648409,93.2125175738238,101.682378617878,111.559526435368,94.9027112853113,102.035523439312,93.1844678062602,106.881093252278,135.168080804318,120.105202555973,94.6796510276375,189.541519745226,110.603923899735,99.0709597287558,97.5874755179099,187.748068474129,99.6026127786687,128.539211926696,164.857114101102,88.84837914187,87.2603478538868,205.527577455609,169.814754609027,99.6603948759612,133.02143319358,101.59116728548,94.9619543189142,151.773093215056,243.558654416981,138.806801359989,105.716586602607,175.830491355995,223.415214343708,211.497685910685,168.404154549304,100.236636590374,146.3332887888,132.475502568426,262.521832736004,95.3834103866996,89.1287577233354,94.9138805596004,100.772254048531,91.3391113688802,188.666527087792,114.110354887549,205.06581158837,197.776858195326,227.63891493789,187.262482700675,118.780498410753,221.49507659225,176.621798486801,263.144877924763,270.917585917869,100.373199864507,261.337137975382,158.907257866401,169.426798401724,203.266634858784,135.462533782603,147.500858486619,187.480539713967,162.606539160241,192.527651082804,193.928808587014,242.843522031657,123.191199366192,158.401913684322,252.732140254876,119.180124207898,107.494628636965,168.847211983506,115.110651898276,229.202533976337,144.892692204449,167.040648604312,170.444885809616,115.36970492171,101.12964055205,170.260726452679,118.317179536812,170.890963361492,213.442399144753,125.724997916748,223.348785814036,112.966973757918,204.868536032904,108.937823652618,100.528497072979,113.429220882537,186.48549515861,111.367781542931,209.567967910124,295.424202503443,274.412505025722,244.584427083963,236.099066987256,107.801618376597,130.995007902379,92.6655915930704,107.000585778478,110.020654043059,237.151318281785,121.906306882046,121.588754642778,142.740723073782,104.157277607259,103.625161166777,263.473730779014,112.707021396639,122.448289075451,128.633560233439,137.637300718596,87.5034750727433,122.039961665907,125.495298408594,96.5506659540497,96.0786352384883,85.752827012013,83.111295666307,93.7800379660422,94.0805905970428,155.27592812268,167.899327808982,190.179481031526,166.236930396997,243.528748937889,121.58772128536,133.095899896143,185.797104162385,84.4733210005902,91.944734163327,93.7411294521867,140.667837371767,203.449034349635,113.533258103184,238.935938123015,142.995993771176,221.789159034247,195.08637256105,154.408642649986,234.699733280291,256.902591770429,104.101836215816,156.188550887841,160.772890954015,232.622735219931,234.404940764365,165.812802404336,114.368252411441,178.610556575323,151.8753995493,235.825450975121,130.07679256334,151.227982796198,109.640383044167,109.448051646116,105.819212479825,137.913785870811,110.797429950225,108.538845393659,125.127785391466,107.306767345963,101.254433300403,109.371295349551,131.803718215663,131.477307067555,128.132013223585,178.171644960419,128.809092416217,245.830239370157,164.656007968239,113.903884959005,178.036317309599,182.594086622028,164.762646986832,179.600632044263,197.711538132269,197.544625372126,206.696415050281,121.851798060332,128.935086648538,169.623487413967,167.681813111476,108.805270142696,279.701677512694,222.964139092551,219.023862103648,224.194034610117,111.049734123515,116.801625092191,117.463545160836,110.532529220112,161.3460354366,126.506841210867,91.9312768352822,142.893102627796,83.5690093738663,79.0797577280505,84.3663879587871,100.037272952542,100.096520382854,78.0205498794765,97.857213585853,96.1280748798673,94.1638054018279,98.1287675042101,101.41026141295,102.687492011419,111.731454469698,115.935485051422,271.361918908014,241.968892107901,152.991330174208,99.3694187565811,91.5424982148129,90.5959243989839,213.622746368973,117.232470069798,112.059591544578,139.309740355123,102.71319163118,83.7996086096397,86.8617636154316,99.9833082187974,84.6612625298699,94.3350984248802,80.5039305892849,82.1480472066697,184.300984828881,200.823017434485,83.1187858797141,113.710832277561,127.224461758153,182.540327622573,163.044953696565,123.698245730293,123.539181310029,153.321536757119,144.10461447662,187.39305371999,187.795624580829,94.3812524257557,112.59161423088,137.439394936708,146.223742391567,81.4670933712585,142.327235939174,212.546885091986,140.317195347628,166.76061847244,124.675860291018,177.203076810421,100.231867545452,101.418163705621,111.794660853054,116.675977228119,147.970831084991,107.203887889558,100.43952726382,125.24191775274,116.154884734783,133.79601835918,103.667378358349,116.173169109101,157.464647609136,129.710266615565,147.281620819769,116.048040383564,107.679434485666,111.814278263966,113.594103830642,118.436344788143,148.881840744506,109.151592632228,103.870241491983,119.268557071202,107.774300890092,111.209706176772,111.077376451669,139.009414292581,113.423155662171,115.671044125729,101.727300442841,142.522177607712,182.693568662872,112.782894014787,113.982904503591,112.544427593148,110.231418557966,105.142456061292,110.547797786105,149.675828765488,104.820955549418,101.773363227597,109.344842509262,117.108627932601,106.666746779708,102.165622311337,156.347950723782,199.067569478347,168.701417916788,113.84275597379,180.848131046561,162.516571619673,172.504367690783,120.002508747888,107.750131672473,144.541924426354,113.635431902618,183.89727972225,161.114461948446,111.587669821085,160.897197698324,175.454044878766,140.138392423445,153.139251705003,180.317744493398,110.074529986736,133.876395682318,111.079489826932,102.177058608507,170.203718895902,111.742298314609,149.535036988464,129.20415112595,106.272677350719,126.598693578321,103.204792631472,105.952926454815,96.0593096927366,111.103941690024,98.3015780726957,109.936912178239,115.864759945743,112.678327023389,112.511246108629,144.695501910049,120.559128565707,135.046883103423,177.846072329443],"x":[197.2,139.06,82.655,85.62,70.415,80.5,63.47,81.635,62.9,125,102.43,105.08,171.94,71.11,87.61,151.67,93.67,184.85,152.78,189.55,164.94,98.135,56.72,67.14,140,51.56,134.71,36.68,243.715,198.33,160.4,170.23,87.63,53.44,253.12,46.28,53.14,43.49,51.13,128.42,102.78,97.14,156.27,85.31,73.43,80.04,174.69,183.45,62.57,239.73,49.57,67.87,237.47,61.2,128.63,111.96,109.1,193.53,157.87,142.38,65.34,158.61,93.61,101.33,72.57,142.92,173.67,270.83,119.42,191.39,77.4,83.57,156.745,58.29,289,216.93,69.88,112.99,109.44,172.87,101.665,113.97,115.5,753.31,142.98,64.475,65.54,147.08,215.03,150,175.86,198.38,143.62,74.12,70,104.72,215,179.06,137.45,54.9,282.64,160.61,111.5,226.565,356.16,143.35,92.96,126.92,164.17,145.96,423.9,179.02,65.08,132.8,161.225,94.97,114.92,113.95,325.53,110.63,165.05,74.415,57.6,112.735,114.86,175,53,103,42.61,160,115.14,103.3,138.75,176.875,225.88,79.6,68.8,93.1,143,132,107.01,69.38,106.33,171.13,91.67,128.17,146,84.17,240.67,51.7,58.45,153.45,115.67,53.17,88.15,65,90.475,33.05,170.39,71.06,57.15,127.97,98.34,108.84,154.015,155.86,75.315,49.56,148.33,123,173.64,114.9,200.75,130.58,87.5,259.25,102.67,79.29,137.92,106.31,191.33,111.455,133.11,84.67,91.27,176.53,147.43,144.32,81.25,88.33,241.81,392.2,106.19,142.54,78.33,228.65,125,250.16,177.49,105,267,248.35,171.94,121.96,84.35,90.19,183.79,116.78,215.65,258.95,129.35,108.33,121.75,136.135,477.27,97.515,125,108.39,114.86,119.725,113.25,210.48,93.55,73.23,177.91,279.24,106.37,171.43,111.265,52,94.015,102.81,120.71,158.86,67.71,55.82,56.25,155.945,165.58,100.29,123.905,226.52,121.11,90.95,200.51,189.075,170.9,208.82,119.24,141.31,89.23,101.69,92.83,150.585,101.39,108.33,103.515,78.66,89.17,100.28,75.83,135,137.17,173.05,70.89,75.84,204.89,88.75,45.83,129.24,188.69,96.26,75.46,97.36,87.97,154,65,116.38,73.78,120.88,82.47,127.31,60.13,148.17,118.51,143.89,102.74,107.99,35.175,69.07,116.29,74.955,128.905,133.33,111.2,142.29,162.78,123.25,100,113.03,56.88,37.04,76.61,104.38,285.99,135,74.31,95.56,67.5,164.165,94.62,62.82,73.48,109.32,130,76.08,381.34,153.75,178.06,122.11,71.67,123.43,54.17,80.75,53.33,125.345,194.92,281.77,141.35,124.75,153.74,143.39,93.285,86,160,238.67,53.29,72.38,112.51,181.99,116.57,100.63,80.83,91.25,82.69,87.475,53.61,98.355,142.5,156.79,80,144.6,124.51,242.26,303.02,106.815,250.79,244.5,119.75,132.06,284.54,175.21,98.88,108.33,109.88,129.58,118.33,105.32,82.21,87.17,61.42,47.62,125,89.44,235.645,82.08,65.955,263.9,32.24,99.69,185.83,94.33,398.78,245.04,158.89,70.3,156.77,121.17,210.82,112.52,80.55,446.06,297.62,136.2,157.58,123.28,134.785,153.22,100,112.65,125.23,99.09,54.86,57.13,241.445,32.21,93.19,94.79,78.91,129,99.14,82,33.61,100.91,109.52,48.32,201.51,121.46,65.21,65,72.92,56.41,76.99,97.66,100,68.83,154.15,203.12,124.61,78.615,131.53,68.96,117,150,160.01,92.59,160.02,129.77,90.36,195.22,141.22,96.55,74.32,91.71,208.29,85.29,109.3,129,119.33,99.42,84.27,76.65,58.73,88.09,136.5,130.18,96.67,190.25,135.91,86.1,129.47,130.51,91.54,56.63,67.4,52.11,92.12,154.88,45.42,99.19,100.82,53.54,55.75,81.5,180.25,137.61,86.94,116.67,325,99.65,124.25,136.36,160.97,100,147.5,138.68,145.315,191.67,108,150,61.06,91.44,56.72,140.95,117.67,70.96,112.14,105.14,260.98,156.19,92.97,84.11,142.03,73.67,152.54,117.29,215,139.05,117.64,108.03,81.49,47.955,126.71,110,112.9,69.34,139.58,95,167.15,246,181.25,149.07,180.25,66.54,106.99,139.1,89.06,76.43,139.39,108.23,74.86,59.39,98.17,174.29,278.11,84.69,122.55,180.67,113.43,133.13,156.25,302.07,165.17,136.25,342.75,228.75,184.815,120,108.33,186.39,114.895,115.84,86.8,163.46,116.94,121.39,97.73,125.27,104.015,83.31,116.165,144,194.98,432.92,482.33,168.41,120.73,102.54,140.2,118.25,80.44,136.21,254.15,113.655,121.67,95.63,53.97,32.605,118.67,174.37,395.44,879.9,375,266.67,483.21,533.61,203.17,116.39,425.995,141.6,481.02,90,143.75,184.47,117.67,90.68,208.66,91.73,151.94,116.04,95.88,113.615,173.1,132.85,98.18,100,176.39,126.25,133.75,115.23,123.59,91.23,87.75,89,136.67,217.5,60.76,74.91,126.81,276.73,114.55,72.585,89.12,84.95,44.48,64.43,149.61,100.83,124.33,128.06,43.18,68.13,105.19,107.38,39.44,201.4,164.79,200.305,81.4,155.15,191.25,163.56,90.06,68.06,139.21,43.33,88.515,201.43,112.5,249.55,62.86,120.55,116.02,129.54,99.6,92.78,99.71,333.34,84.93,87.18,75.56,118.215,189.91,190.35,285.75,203.95,107.14,87.54,58.75,112.96,119.58,51.13,240.41,120,185.27,125,95.96,296.46,194.96,166.67,219.26,293.97,360,259.38,70.9,106.25,116.5,110.96,73.15,98.23,67.5,139,68.19,169.78,148.75,98.6,82.11,154.97,89.78,75.75,45.57,171.61,107.96,56.11,125.775,117.38,116.97,125.365,71.47,260.21,85,75.33,73.83,104.4,120.67,77.12,99.42,101.575,131.46,107.5,113.33,55.96,250.42,155.17,79.63,98.02,97.25,167.475,94.9,42.96,152.6,64.23,110.915,58.25,102.59,89.89,69.48,111.19,169.16,80.33,163.34,52,91.25,103.75,295.73,125.305,145,194.04,133.61,77.095,396.91,235.53,154.59,65.835,119.13,80.88,117.07,155.88,151.41,58.03,200.89,246.75,329.815,150.66,84.71,143,112.32,100,97.92,54.97,80.665,97.5,58.14,104.72,131.01,111.165,181.295,181.05,118.33,87.79,175.5,166.78,314.68,173.17,116.46,218.33,134.38,159.13,214.39,128.37,124.03,146.31,120.25,265.1,184.17,163.92,75.67,236.655,279.83,176.78,70.42,116.33,121.48,141.05,137.78,146.66,215.36,91.825,136.85,129.75,156.54,130,231.02,130,302.92,87.395,188.35,104.55,111.31,78.54,151.38,93.58,191.24,215.71,328.275,256.67,205.22,119.67,118.75,96.92,76.98,55.58,201.38,189.76,97.5,132.17,98.79,65.16,80,104.73,96.915,123.17,156.2,38.47,87.25,160.105,173.55,126.205,106.92,94.55,136.67,74.44,173.41,191.19,160.88,127.67,184.77,94.82,125.03,194.32,67.24,68.7,115.325,118.33,269.78,67.92,126.67,131.2,254.15,126.69,135.56,159.96,220,79.17,340.205,190.13,332.34,121.82,210.6,107.6,187.24,140.19,336.235,87.61,136.49,95.36,77.14,95.86,129.86,66.64,79.82,196.48,62.28,139.84,122.14,139.67,120.92,100.68,247.025,102.635,212.685,190.99,107.67,166.67,139.85,92.005,233.92,145.91,156.875,255.71,150.3,59.46,279.3,111.46,81.455,265,136.56,174.53,310.96,105.43,109.71,78.01,93.52,147.72,102.78,67.33,132.56,62.44,71.03,116.67,74.78,147.985,109.33,120.79,100.07,93.605,64.65,137.44,118.77,144.06,119.675,197.64,256.685,110.84,75.64,52.25,96.47,175,146.88,113.97,200,131.315,50.33,92.71,90.48,92.08,113.49,84.19,76.105,197.98,173,74.46,178.06,159.96,152.5,153.665,128.84,83.19,211.11,138.46,90.61,132.52,99.44,194.52,140.95,149.58,100,213.33,228.03,118.75,188.62,108.5,196.08,74.92,56.68,111.76,88.05,129.02,48.86,50.27,126.81,58.18,188.44,123.86,69.88,94,224.94,142.78,86.67,63.89,58.36,131.35,90.27,187.335,76.64,53.04,143.4,64.29,93.92,167.63,223.04,108.8,90.175,135,148.31,202.75,119.31,100.84,145.14,75.86,51.95,88.37,250,98.83,77.88,93.47,100,49.57,75.63,248,207.65,91.56,81.67,117,178.28,215.23,106.13,74.03,191.07,123.63,118.92,176.11,115.84,218.32,251.13,261.16,161.11,229.05,65.07,241.1,84.88,95.08,225,90.86,300,160,168.33,101.04,131.63,108.29,119.9,73.36,74,89.625,105.055,136.39,98.05,112.515,112.67,86.85,237.39],"mode":"markers","marker":{"color":"black","opacity":0.3,"line":{"color":"rgba(31,119,180,1)"}},"name":"training set","type":"scatter","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"y":[91.8363405487808,114.64214506328,183.899453814878,114.108380371469,134.877254114472,97.0564157473747,146.746598405243,113.853041081552,111.432486640218,95.9493254897739,106.209913621131,94.5879050907877,120.327296392176,90.6880968117381,231.259976392095,113.288548823804,149.064831473469,110.649208653329,196.672647020687,385.554065482008,349.23915189874,99.6193124594069,180.633079515358,169.655707490586,120.238246796991,120.504531706445,143.192891330761,172.106728822303,97.4919621550684,180.897007307782,101.616840247609,170.874921761676,99.4214221417552,112.197115474145,138.810810199574,236.638734651949,103.67112119778,177.175744217454,94.3276098288616,157.669324307857,255.84487378524,135.668901355554,112.186486061459,268.141944343011,114.344216892394,97.6880973301588,80.291201762174,81.7079924466272,105.159533838766,116.906292939054,130.177219852026,101.281090588124,123.731087098366,111.808567051805,118.098178749571,173.930287792714,116.571330938581,174.729683317019,109.697903277319,108.020350970676,103.728227385713,121.388718687465,108.710581392963,89.2474027532763,114.094646324825,170.129568458489,103.459762840002,219.863732701375,96.5633515949121,114.30928040432,151.7887429466,101.108675059509,97.1385766354928,126.163370790647,147.273409530196,108.788632659669,99.6709931037544,114.33248743574,216.690003432267,95.1480970018468,101.795829069032,121.85990106421,107.86709070159,120.605025477235,157.078844676156,96.9726762408548,94.3324233410104,114.47250222698,136.775312464769,107.081644914553,164.816195095432,98.7990720945475,158.071340061761,188.033610261158,185.812414812076,154.811023878766,166.210707010873,97.3994301255069,139.916251126855,113.705106782015,97.9927721023758,96.0434892808364,95.7133848526123,93.0431632619265,91.5000957159939,89.7706795069684,94.2295440237818,90.3081566171478,124.886317622378,104.397878526416,90.8954679364136,113.972406406959,94.8800557748006,137.272046899843,124.455094964403,135.175624994717,124.829626757145,96.7959605115949,108.850831401184,142.285531446038,99.4876756403781,99.2526527537294,274.532058197767,185.739310683509,141.854083787764,123.017839977356,98.343909266444,135.692234375628,127.918689735582,157.153586003976,260.503954772674,139.858575474424,138.465541093825,168.701593730254,111.866477940247,117.509646544776,258.832002817556,283.63810343886,176.205310400624,138.689636012119,110.848047611733,129.434522306551,160.31528043586,111.611696629595,102.839871297709,97.8091249045005,365.705815118896,115.128078444689,106.004453249028,204.902621868281,180.332191159681,304.200075849588,90.5476912221243,139.311860050021,129.057662050782,108.54442607294,180.297339709818,85.952539594083,146.169462742567,217.30121889958,247.91094305947,183.166863495179,95.5061618679316,234.250453682236,89.6289883451758,97.4247993842555,102.173005203965,114.712577339245,125.525289112397,93.5074057339823,153.849252488079,92.125764964172,98.179932657903,95.676911564285,115.732328697863,96.7093666977565,117.032178002481,141.851151469984,110.179105545696,96.4836576607269,133.283354272407,99.5201453786548,181.056311555418,101.982255244215,97.0974123974823,102.442072783719,80.7243992881689,211.657444768946,90.018844288651,116.997137604629,117.675354923658,149.958670545536,137.828785546934,104.735840061909,220.419795565759,269.011315919587,131.805413763401,108.282154659471,168.647802388382,146.570279158525,162.712706671,114.442346353104,98.8532139655056,121.334713768031,156.736383052818,145.546971204928,201.981173302072,161.837636815664,102.616130542136,79.515529104116,178.727773193071,171.072480390902,145.549995450726,120.578053595148,230.061529911329,212.21431913919,81.4829451252262,152.809291832496,93.697606946677,98.0546882891745,205.726762316935,271.898041403515,313.299530263916,209.219013697862,154.480972956812,259.664241818119,182.897534707642,139.550944421081,200.639925490356,81.1094351579792,103.600284191228,100.290957012597,81.5295008283155,97.5420172239539,121.846559150577,183.244896946558,118.206208716098,142.162260482059,109.197406467268,102.777118769977,177.925071078392,99.1023044719598,139.108128735286,140.493106046846,106.011370505039,98.6901654145564,118.528497321976,105.186147016622,117.837313023617,113.91133239735,99.6299617920372,110.934320955968,112.693033477172,203.087647848881,105.061848015804,189.092137294673,134.379211760345,189.084876737308,113.996649807095,120.358391771558],"x":[111.94,156,320.66,111.32,174.375,64.25,200,175.34,120.94,42.29,98.2,53.3,193.945,87.4,128.33,141.28,145,125.73,127.54,281.09,191.21,50.73,101.39,114,81.94,101.39,128.32,251.46,71.49,197.73,72.885,200.22,162.83,132.15,184.17,192.08,143.92,208,88.54,184.38,265.43,140.94,131.9,241.88,93.89,127.5,51.13,95.42,111.87,87.56,157.38,58.78,146.98,92.43,116.38,243.33,132.5,281.34,84.27,65.04,131.39,108.61,101.11,82.17,117.67,178.33,95.81,403.82,122.15,179.66,122.54,66.32,83.98,150.17,251.25,92.17,76.605,123,150.18,129.17,187.5,112.11,104.855,131.4,124.46,56.42,60.43,127.73,176.44,110.71,118.11,129.89,127.56,250,126.32,129.99,205.56,75.5,97.56,164.53,92.5,60.23,105.46,45.15,101.45,63.26,141.2,112.5,179.81,77.52,123.31,73.37,70.51,108.51,89.35,105.14,236.32,69.62,165.83,124.27,112.64,127.34,291.06,236.58,203.34,122.78,70.29,138.6,115.255,258.21,158,147.56,153.43,125.49,108.34,78.73,168.95,227.94,177.86,143.77,81.67,111.84,134.13,132.57,68.78,75,211.87,136.385,66.33,234.95,151.19,165.975,46.18,205.83,123.335,116.45,65.62,49.78,118.445,117.81,194.03,199.33,88.33,157.44,40.615,108.83,158.17,208.65,180,81.31,160.14,68.63,75.13,73.83,80.73,103.94,89.56,200,204.17,66.94,127.88,68.27,115.83,133.33,91.76,102.52,75.34,230.35,162.68,90.81,129.9,158.56,208.84,53.61,169.08,175,133.64,98.835,152.5,108.3,160.67,114.44,113.94,194.445,214.62,145,113.43,156.31,58.27,129.02,145.86,121.62,203.4,100.675,244.17,173,165.92,207.08,51.78,93.92,290.63,115.92,217.34,224.38,162.76,275.57,277.81,232.07,136.78,57.96,135.49,71.33,73.05,85.86,91.53,69.33,91.85,92.63,90.83,76.28,234.76,73.08,151.3,100.75,89.605,86.32,161.94,115.15,121.84,95.67,134.95,155.67,67.64,143.93,89.21,177.69,158.45,186.33,128.45,50.42],"mode":"markers","marker":{"color":"red","opacity":0.3,"line":{"color":"rgba(255,127,14,1)"}},"name":"validation set","type":"scatter","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"y":[0,880],"x":[0,880],"mode":"lines+markers","marker":{"color":"black","opacity":0.3,"line":{"color":"rgba(44,160,44,1)"}},"name":"1:1","type":"scatter","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 5.1: Observed versus Predicted Income Values, BYM 2 Model with Covariates Selected with the Backward Stepwise Selection Process
</p>
</div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>Processor: Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz, 16.0 GB RAM.<a href="stepwise.html#fnref3" class="footnote-back">â©ï¸</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="simple-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summary-of-resuls.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
